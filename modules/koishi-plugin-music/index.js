var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var b=(e,t)=>()=>(e&&(t=e(e=0)),t);var $=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var m=(e,t,a,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of g(t))!q.call(e,n)&&n!==a&&l(e,n,{get:()=>t[n],enumerable:!(o=y(t,n))||o.enumerable});return e},u=(e,t,a)=>(m(e,t,"default"),a&&m(a,t,"default"));var j=e=>m(l({},"__esModule",{value:!0}),e);var i={};import*as C from"https://registry.koishi.chat/modules/koishi/index.js";var d=b(()=>{u(i,C)});var w=$(s=>{Object.defineProperty(s,"__esModule",{value:!0});s.apply=s.name=s.Config=void 0;var c=(d(),j(i));s.Config=c.Schema.object({showWarning:c.Schema.boolean().default(!1).description("点歌失败时是否发送提示。"),platform:c.Schema.union(["netease","qq"]).default("qq").description("默认的点歌平台。")});var h={async netease(e){let t=await this.http.get("http://music.163.com/api/cloudsearch/pc",{params:{s:e,type:1,offset:0,limit:5}});if(t.code!==200||t.result.songCount===0)return;let a=t.result.songs[0];return{type:"163",id:a.id,name:a.name,artist:a.ar.map(o=>o.name).join("/"),url:`https://music.163.com/#/song?id=${a.id}`}},async qq(e){let t=await this.http.get("https://c.y.qq.com/splcloud/fcgi-bin/smartbox_new.fcg",{params:{key:e,format:"json"}});if(t.code||t.data.song.count===0)return;let a=t.data.song.itemlist[0];return{type:"qq",id:a.id,name:a.name,artist:a.singer,url:`https://y.qq.com/n/ryqq/songDetail/${a.mid}`}}};s.name="music";function z(e,t){let{showWarning:a,platform:o}=t;e.command("music <name:text>","点歌").option("platform",`-p <platform>  点歌平台，目前支持 qq, netease，默认为 ${o}`,{type:Object.keys(h)}).alias("点歌").shortcut("来一首",{fuzzy:!0}).shortcut("点一首",{fuzzy:!0}).shortcut("整一首",{fuzzy:!0}).action(async({options:n},p)=>{n.platform||(n.platform=o);let f=h[n.platform];if(!f)return`目前不支持平台 ${n.platform}。`;if(!p)return"请输入歌曲相关信息。";try{let r=await f.call(e,p);if(typeof r=="object")return(0,c.segment)("onebot:music",r,`${r.name}
${r.artist}
${r.url}`)}catch{}if(a)return"点歌失败，请尝试更换平台。"})}s.apply=z});export default w();
