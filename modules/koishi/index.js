var ls=Object.create;var Ur=Object.defineProperty;var fs=Object.getOwnPropertyDescriptor;var hs=Object.getOwnPropertyNames;var ps=Object.getPrototypeOf,ds=Object.prototype.hasOwnProperty;var D=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ms=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of hs(t))!ds.call(e,i)&&i!==r&&Ur(e,i,{get:()=>t[i],enumerable:!(n=fs(t,i))||n.enumerable});return e};var St=(e,t,r)=>(r=e!=null?ls(ps(e)):{},ms(t||!e||!e.__esModule?Ur(r,"default",{value:e,enumerable:!0}):r,e));var Hr=D(()=>{});var ln=D((ic,un)=>{var jt=typeof Map=="function"&&Map.prototype,At=Object.getOwnPropertyDescriptor&&jt?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,at=jt&&At&&typeof At.get=="function"?At.get:null,Rs=jt&&Map.prototype.forEach,Mt=typeof Set=="function"&&Set.prototype,Ct=Object.getOwnPropertyDescriptor&&Mt?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,ct=Mt&&Ct&&typeof Ct.get=="function"?Ct.get:null,qs=Mt&&Set.prototype.forEach,Ns=typeof WeakMap=="function"&&WeakMap.prototype,Je=Ns?WeakMap.prototype.has:null,Ts=typeof WeakSet=="function"&&WeakSet.prototype,Ve=Ts?WeakSet.prototype.has:null,Is=typeof WeakRef=="function"&&WeakRef.prototype,Jr=Is?WeakRef.prototype.deref:null,Ds=Boolean.prototype.valueOf,js=Object.prototype.toString,Ms=Function.prototype.toString,Ls=String.prototype.match,Lt=String.prototype.slice,we=String.prototype.replace,Fs=String.prototype.toUpperCase,Vr=String.prototype.toLowerCase,rn=RegExp.prototype.test,Kr=Array.prototype.concat,le=Array.prototype.join,Bs=Array.prototype.slice,Qr=Math.floor,qt=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Pt=Object.getOwnPropertySymbols,Nt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Re=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Z=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Re?"object":"symbol")?Symbol.toStringTag:null,nn=Object.prototype.propertyIsEnumerable,Xr=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function Gr(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||rn.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var n=e<0?-Qr(-e):Qr(e);if(n!==e){var i=String(n),s=Lt.call(t,i.length+1);return we.call(i,r,"$&_")+"."+we.call(we.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return we.call(t,r,"$&_")}var Tt=Hr(),Yr=Tt.custom,Zr=on(Yr)?Yr:null;un.exports=function e(t,r,n,i){var s=r||{};if(be(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(be(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=be(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(be(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(be(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return cn(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var c=String(t);return a?Gr(t,c):c}if(typeof t=="bigint"){var p=String(t)+"n";return a?Gr(t,p):p}var h=typeof s.depth>"u"?5:s.depth;if(typeof n>"u"&&(n=0),n>=h&&h>0&&typeof t=="object")return It(t)?"[Array]":"[Object]";var u=so(s,n);if(typeof i>"u")i=[];else if(an(i,t)>=0)return"[Circular]";function l(I,O,P){if(O&&(i=Bs.call(i),i.push(O)),P){var M={depth:s.depth};return be(s,"quoteStyle")&&(M.quoteStyle=s.quoteStyle),e(I,M,n+1,i)}return e(I,s,n+1,i)}if(typeof t=="function"&&!en(t)){var f=Xs(t),m=ot(t,l);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(m.length>0?" { "+le.call(m,", ")+" }":"")}if(on(t)){var y=Re?we.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Nt.call(t);return typeof t=="object"&&!Re?He(y):y}if(ro(t)){for(var _="<"+Vr.call(String(t.nodeName)),$=t.attributes||[],g=0;g<$.length;g++)_+=" "+$[g].name+"="+sn(Us($[g].value),"double",s);return _+=">",t.childNodes&&t.childNodes.length&&(_+="..."),_+="</"+Vr.call(String(t.nodeName))+">",_}if(It(t)){if(t.length===0)return"[]";var d=ot(t,l);return u&&!io(d)?"["+Dt(d,u)+"]":"[ "+le.call(d,", ")+" ]"}if(Ws(t)){var v=ot(t,l);return!("cause"in Error.prototype)&&"cause"in t&&!nn.call(t,"cause")?"{ ["+String(t)+"] "+le.call(Kr.call("[cause]: "+l(t.cause),v),", ")+" }":v.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+le.call(v,", ")+" }"}if(typeof t=="object"&&o){if(Zr&&typeof t[Zr]=="function"&&Tt)return Tt(t,{depth:h-n});if(o!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(Gs(t)){var w=[];return Rs.call(t,function(I,O){w.push(l(O,t,!0)+" => "+l(I,t))}),tn("Map",at.call(t),w,u)}if(eo(t)){var E=[];return qs.call(t,function(I){E.push(l(I,t))}),tn("Set",ct.call(t),E,u)}if(Ys(t))return Rt("WeakMap");if(to(t))return Rt("WeakSet");if(Zs(t))return Rt("WeakRef");if(Js(t))return He(l(Number(t)));if(Ks(t))return He(l(qt.call(t)));if(Vs(t))return He(Ds.call(t));if(Hs(t))return He(l(String(t)));if(!zs(t)&&!en(t)){var N=ot(t,l),b=Xr?Xr(t)===Object.prototype:t instanceof Object||t.constructor===Object,x=t instanceof Object?"":"null prototype",k=!b&&Z&&Object(t)===t&&Z in t?Lt.call(xe(t),8,-1):x?"Object":"",C=b||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",A=C+(k||x?"["+le.call(Kr.call([],k||[],x||[]),": ")+"] ":"");return N.length===0?A+"{}":u?A+"{"+Dt(N,u)+"}":A+"{ "+le.call(N,", ")+" }"}return String(t)};function sn(e,t,r){var n=(r.quoteStyle||t)==="double"?'"':"'";return n+e+n}function Us(e){return we.call(String(e),/"/g,"&quot;")}function It(e){return xe(e)==="[object Array]"&&(!Z||!(typeof e=="object"&&Z in e))}function zs(e){return xe(e)==="[object Date]"&&(!Z||!(typeof e=="object"&&Z in e))}function en(e){return xe(e)==="[object RegExp]"&&(!Z||!(typeof e=="object"&&Z in e))}function Ws(e){return xe(e)==="[object Error]"&&(!Z||!(typeof e=="object"&&Z in e))}function Hs(e){return xe(e)==="[object String]"&&(!Z||!(typeof e=="object"&&Z in e))}function Js(e){return xe(e)==="[object Number]"&&(!Z||!(typeof e=="object"&&Z in e))}function Vs(e){return xe(e)==="[object Boolean]"&&(!Z||!(typeof e=="object"&&Z in e))}function on(e){if(Re)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!Nt)return!1;try{return Nt.call(e),!0}catch{}return!1}function Ks(e){if(!e||typeof e!="object"||!qt)return!1;try{return qt.call(e),!0}catch{}return!1}var Qs=Object.prototype.hasOwnProperty||function(e){return e in this};function be(e,t){return Qs.call(e,t)}function xe(e){return js.call(e)}function Xs(e){if(e.name)return e.name;var t=Ls.call(Ms.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function an(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function Gs(e){if(!at||!e||typeof e!="object")return!1;try{at.call(e);try{ct.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function Ys(e){if(!Je||!e||typeof e!="object")return!1;try{Je.call(e,Je);try{Ve.call(e,Ve)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function Zs(e){if(!Jr||!e||typeof e!="object")return!1;try{return Jr.call(e),!0}catch{}return!1}function eo(e){if(!ct||!e||typeof e!="object")return!1;try{ct.call(e);try{at.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function to(e){if(!Ve||!e||typeof e!="object")return!1;try{Ve.call(e,Ve);try{Je.call(e,Je)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function ro(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function cn(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return cn(Lt.call(e,0,t.maxStringLength),t)+n}var i=we.call(we.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,no);return sn(i,"single",t)}function no(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+Fs.call(t.toString(16))}function He(e){return"Object("+e+")"}function Rt(e){return e+" { ? }"}function tn(e,t,r,n){var i=n?Dt(r,n):le.call(r,", ");return e+" ("+t+") {"+i+"}"}function io(e){for(var t=0;t<e.length;t++)if(an(e[t],`
`)>=0)return!1;return!0}function so(e,t){var r;if(e.indent==="	")r="	";else if(typeof e.indent=="number"&&e.indent>0)r=le.call(Array(e.indent+1)," ");else return null;return{base:r,prev:le.call(Array(t+1),r)}}function Dt(e,t){if(e.length===0)return"";var r=`
`+t.prev+t.base;return r+le.call(e,","+r)+`
`+t.prev}function ot(e,t){var r=It(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=be(e,i)?t(e[i],e):""}var s=typeof Pt=="function"?Pt(e):[],o;if(Re){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var c in e)!be(e,c)||r&&String(Number(c))===c&&c<e.length||Re&&o["$"+c]instanceof Symbol||(rn.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e)));if(typeof Pt=="function")for(var p=0;p<s.length;p++)nn.call(e,s[p])&&n.push("["+t(s[p])+"]: "+t(e[s[p]],e));return n}});var pn=D((sc,hn)=>{"use strict";function oo(){let e=/(Chrome|Chromium)\/(?<chromeVersion>\d+)\./.exec(navigator.userAgent);if(!!e)return Number.parseInt(e.groups.chromeVersion,10)}var fn=oo()>=69?{level:1,hasBasic:!0,has256:!1,has16m:!1}:!1;hn.exports={stdout:fn,stderr:fn}});var sr=D((Jc,Tn)=>{"use strict";Tn.exports=function(t,r){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(r,i)}}});var V=D((Vc,jn)=>{"use strict";var Io=sr(),ar=Object.prototype.toString,cr=function(e){return function(t){var r=ar.call(t);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function ke(e){return e=e.toLowerCase(),function(r){return cr(r)===e}}function ur(e){return Array.isArray(e)}function dt(e){return typeof e>"u"}function Do(e){return e!==null&&!dt(e)&&e.constructor!==null&&!dt(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}var In=ke("ArrayBuffer");function jo(e){var t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&In(e.buffer),t}function Mo(e){return typeof e=="string"}function Lo(e){return typeof e=="number"}function Dn(e){return e!==null&&typeof e=="object"}function pt(e){if(cr(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var Fo=ke("Date"),Bo=ke("File"),Uo=ke("Blob"),zo=ke("FileList");function lr(e){return ar.call(e)==="[object Function]"}function Wo(e){return Dn(e)&&lr(e.pipe)}function Ho(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||ar.call(e)===t||lr(e.toString)&&e.toString()===t)}var Jo=ke("URLSearchParams");function Vo(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ko(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function fr(e,t){if(!(e===null||typeof e>"u"))if(typeof e!="object"&&(e=[e]),ur(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function or(){var e={};function t(i,s){pt(e[s])&&pt(i)?e[s]=or(e[s],i):pt(i)?e[s]=or({},i):ur(i)?e[s]=i.slice():e[s]=i}for(var r=0,n=arguments.length;r<n;r++)fr(arguments[r],t);return e}function Qo(e,t,r){return fr(t,function(i,s){r&&typeof i=="function"?e[s]=Io(i,r):e[s]=i}),e}function Xo(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e}function Go(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)}function Yo(e,t,r){var n,i,s,o={};t=t||{};do{for(n=Object.getOwnPropertyNames(e),i=n.length;i-- >0;)s=n[i],o[s]||(t[s]=e[s],o[s]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t}function Zo(e,t,r){e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return n!==-1&&n===r}function ea(e){if(!e)return null;var t=e.length;if(dt(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r}var ta=function(e){return function(t){return e&&t instanceof e}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array));jn.exports={isArray:ur,isArrayBuffer:In,isBuffer:Do,isFormData:Ho,isArrayBufferView:jo,isString:Mo,isNumber:Lo,isObject:Dn,isPlainObject:pt,isUndefined:dt,isDate:Fo,isFile:Bo,isBlob:Uo,isFunction:lr,isStream:Wo,isURLSearchParams:Jo,isStandardBrowserEnv:Ko,forEach:fr,merge:or,extend:Qo,trim:Vo,stripBOM:Xo,inherits:Go,toFlatObject:Yo,kindOf:cr,kindOfTest:ke,endsWith:Zo,toArray:ea,isTypedArray:ta,isFileList:zo}});var hr=D((Kc,Ln)=>{"use strict";var De=V();function Mn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}Ln.exports=function(t,r,n){if(!r)return t;var i;if(n)i=n(r);else if(De.isURLSearchParams(r))i=r.toString();else{var s=[];De.forEach(r,function(c,p){c===null||typeof c>"u"||(De.isArray(c)?p=p+"[]":c=[c],De.forEach(c,function(u){De.isDate(u)?u=u.toISOString():De.isObject(u)&&(u=JSON.stringify(u)),s.push(Mn(p)+"="+Mn(u))}))}),i=s.join("&")}if(i){var o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}});var Bn=D((Qc,Fn)=>{"use strict";var ra=V();function mt(){this.handlers=[]}mt.prototype.use=function(t,r,n){return this.handlers.push({fulfilled:t,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1};mt.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)};mt.prototype.forEach=function(t){ra.forEach(this.handlers,function(n){n!==null&&t(n)})};Fn.exports=mt});var zn=D((Xc,Un)=>{"use strict";var na=V();Un.exports=function(t,r){na.forEach(t,function(i,s){s!==r&&s.toUpperCase()===r.toUpperCase()&&(t[r]=i,delete t[s])})}});var Ae=D((Gc,Vn)=>{"use strict";var Wn=V();function je(e,t,r,n,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}Wn.inherits(je,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Hn=je.prototype,Jn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){Jn[e]={value:e}});Object.defineProperties(je,Jn);Object.defineProperty(Hn,"isAxiosError",{value:!0});je.from=function(e,t,r,n,i,s){var o=Object.create(Hn);return Wn.toFlatObject(e,o,function(c){return c!==Error.prototype}),je.call(o,e.message,t,r,n,i),o.name=e.name,s&&Object.assign(o,s),o};Vn.exports=je});var pr=D((Yc,Kn)=>{"use strict";Kn.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}});var dr=D((Zc,Qn)=>{"use strict";var ce=V();function ia(e,t){t=t||new FormData;var r=[];function n(s){return s===null?"":ce.isDate(s)?s.toISOString():ce.isArrayBuffer(s)||ce.isTypedArray(s)?typeof Blob=="function"?new Blob([s]):Buffer.from(s):s}function i(s,o){if(ce.isPlainObject(s)||ce.isArray(s)){if(r.indexOf(s)!==-1)throw Error("Circular reference detected in "+o);r.push(s),ce.forEach(s,function(c,p){if(!ce.isUndefined(c)){var h=o?o+"."+p:p,u;if(c&&!o&&typeof c=="object"){if(ce.endsWith(p,"{}"))c=JSON.stringify(c);else if(ce.endsWith(p,"[]")&&(u=ce.toArray(c))){u.forEach(function(l){!ce.isUndefined(l)&&t.append(h,n(l))});return}}i(c,h)}}),r.pop()}else t.append(o,n(s))}return i(e),t}Qn.exports=ia});var Gn=D((eu,Xn)=>{"use strict";var mr=Ae();Xn.exports=function(t,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):r(new mr("Request failed with status code "+n.status,[mr.ERR_BAD_REQUEST,mr.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}});var Zn=D((tu,Yn)=>{"use strict";var yt=V();Yn.exports=yt.isStandardBrowserEnv()?function(){return{write:function(r,n,i,s,o,a){var c=[];c.push(r+"="+encodeURIComponent(n)),yt.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),yt.isString(s)&&c.push("path="+s),yt.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()});var ti=D((ru,ei)=>{"use strict";ei.exports=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}});var ni=D((nu,ri)=>{"use strict";ri.exports=function(t,r){return r?t.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):t}});var yr=D((iu,ii)=>{"use strict";var sa=ti(),oa=ni();ii.exports=function(t,r){return t&&!sa(r)?oa(t,r):r}});var oi=D((su,si)=>{"use strict";var gr=V(),aa=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];si.exports=function(t){var r={},n,i,s;return t&&gr.forEach(t.split(`
`),function(a){if(s=a.indexOf(":"),n=gr.trim(a.substr(0,s)).toLowerCase(),i=gr.trim(a.substr(s+1)),n){if(r[n]&&aa.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r}});var ui=D((ou,ci)=>{"use strict";var ai=V();ci.exports=ai.isStandardBrowserEnv()?function(){var t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(s){var o=s;return t&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(o){var a=ai.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}()});var Ge=D((au,fi)=>{"use strict";var vr=Ae(),ca=V();function li(e){vr.call(this,e??"canceled",vr.ERR_CANCELED),this.name="CanceledError"}ca.inherits(li,vr,{__CANCEL__:!0});fi.exports=li});var pi=D((cu,hi)=>{"use strict";hi.exports=function(t){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}});var br=D((uu,di)=>{"use strict";var Ye=V(),ua=Gn(),la=Zn(),fa=hr(),ha=yr(),pa=oi(),da=ui(),ma=pr(),me=Ae(),ya=Ge(),ga=pi();di.exports=function(t){return new Promise(function(n,i){var s=t.data,o=t.headers,a=t.responseType,c;function p(){t.cancelToken&&t.cancelToken.unsubscribe(c),t.signal&&t.signal.removeEventListener("abort",c)}Ye.isFormData(s)&&Ye.isStandardBrowserEnv()&&delete o["Content-Type"];var h=new XMLHttpRequest;if(t.auth){var u=t.auth.username||"",l=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var f=ha(t.baseURL,t.url);h.open(t.method.toUpperCase(),fa(f,t.params,t.paramsSerializer),!0),h.timeout=t.timeout;function m(){if(!!h){var $="getAllResponseHeaders"in h?pa(h.getAllResponseHeaders()):null,g=!a||a==="text"||a==="json"?h.responseText:h.response,d={data:g,status:h.status,statusText:h.statusText,headers:$,config:t,request:h};ua(function(w){n(w),p()},function(w){i(w),p()},d),h=null}}if("onloadend"in h?h.onloadend=m:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(m)},h.onabort=function(){!h||(i(new me("Request aborted",me.ECONNABORTED,t,h)),h=null)},h.onerror=function(){i(new me("Network Error",me.ERR_NETWORK,t,h,h)),h=null},h.ontimeout=function(){var g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",d=t.transitional||ma;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),i(new me(g,d.clarifyTimeoutError?me.ETIMEDOUT:me.ECONNABORTED,t,h)),h=null},Ye.isStandardBrowserEnv()){var y=(t.withCredentials||da(f))&&t.xsrfCookieName?la.read(t.xsrfCookieName):void 0;y&&(o[t.xsrfHeaderName]=y)}"setRequestHeader"in h&&Ye.forEach(o,function(g,d){typeof s>"u"&&d.toLowerCase()==="content-type"?delete o[d]:h.setRequestHeader(d,g)}),Ye.isUndefined(t.withCredentials)||(h.withCredentials=!!t.withCredentials),a&&a!=="json"&&(h.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&h.addEventListener("progress",t.onDownloadProgress),typeof t.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(c=function($){!h||(i(!$||$&&$.type?new ya:$),h.abort(),h=null)},t.cancelToken&&t.cancelToken.subscribe(c),t.signal&&(t.signal.aborted?c():t.signal.addEventListener("abort",c))),s||(s=null);var _=ga(f);if(_&&["http","https","file"].indexOf(_)===-1){i(new me("Unsupported protocol "+_+":",me.ERR_BAD_REQUEST,t));return}h.send(s)})}});var yi=D((lu,mi)=>{mi.exports=null});var vt=D((fu,wi)=>{"use strict";var K=V(),gi=zn(),vi=Ae(),va=pr(),ba=dr(),wa={"Content-Type":"application/x-www-form-urlencoded"};function bi(e,t){!K.isUndefined(e)&&K.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function xa(){var e;return typeof XMLHttpRequest<"u"?e=br():typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]"&&(e=br()),e}function _a(e,t,r){if(K.isString(e))try{return(t||JSON.parse)(e),K.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(e)}var gt={transitional:va,adapter:xa(),transformRequest:[function(t,r){if(gi(r,"Accept"),gi(r,"Content-Type"),K.isFormData(t)||K.isArrayBuffer(t)||K.isBuffer(t)||K.isStream(t)||K.isFile(t)||K.isBlob(t))return t;if(K.isArrayBufferView(t))return t.buffer;if(K.isURLSearchParams(t))return bi(r,"application/x-www-form-urlencoded;charset=utf-8"),t.toString();var n=K.isObject(t),i=r&&r["Content-Type"],s;if((s=K.isFileList(t))||n&&i==="multipart/form-data"){var o=this.env&&this.env.FormData;return ba(s?{"files[]":t}:t,o&&new o)}else if(n||i==="application/json")return bi(r,"application/json"),_a(t);return t}],transformResponse:[function(t){var r=this.transitional||gt.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&K.isString(t)&&t.length)try{return JSON.parse(t)}catch(o){if(s)throw o.name==="SyntaxError"?vi.from(o,vi.ERR_BAD_RESPONSE,this,null,this.response):o}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:yi()},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};K.forEach(["delete","get","head"],function(t){gt.headers[t]={}});K.forEach(["post","put","patch"],function(t){gt.headers[t]=K.merge(wa)});wi.exports=gt});var _i=D((hu,xi)=>{"use strict";var Oa=V(),Sa=vt();xi.exports=function(t,r,n){var i=this||Sa;return Oa.forEach(n,function(o){t=o.call(i,t,r)}),t}});var wr=D((pu,Oi)=>{"use strict";Oi.exports=function(t){return!!(t&&t.__CANCEL__)}});var $i=D((du,Ei)=>{"use strict";var Si=V(),xr=_i(),Ea=wr(),$a=vt(),ka=Ge();function _r(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ka}Ei.exports=function(t){_r(t),t.headers=t.headers||{},t.data=xr.call(t,t.data,t.headers,t.transformRequest),t.headers=Si.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),Si.forEach(["delete","get","head","post","put","patch","common"],function(i){delete t.headers[i]});var r=t.adapter||$a.adapter;return r(t).then(function(i){return _r(t),i.data=xr.call(t,i.data,i.headers,t.transformResponse),i},function(i){return Ea(i)||(_r(t),i&&i.response&&(i.response.data=xr.call(t,i.response.data,i.response.headers,t.transformResponse))),Promise.reject(i)})}});var Or=D((mu,ki)=>{"use strict";var se=V();ki.exports=function(t,r){r=r||{};var n={};function i(h,u){return se.isPlainObject(h)&&se.isPlainObject(u)?se.merge(h,u):se.isPlainObject(u)?se.merge({},u):se.isArray(u)?u.slice():u}function s(h){if(se.isUndefined(r[h])){if(!se.isUndefined(t[h]))return i(void 0,t[h])}else return i(t[h],r[h])}function o(h){if(!se.isUndefined(r[h]))return i(void 0,r[h])}function a(h){if(se.isUndefined(r[h])){if(!se.isUndefined(t[h]))return i(void 0,t[h])}else return i(void 0,r[h])}function c(h){if(h in r)return i(t[h],r[h]);if(h in t)return i(void 0,t[h])}var p={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return se.forEach(Object.keys(t).concat(Object.keys(r)),function(u){var l=p[u]||s,f=l(u);se.isUndefined(f)&&l!==c||(n[u]=f)}),n}});var Sr=D((yu,Ai)=>{Ai.exports={version:"0.27.2"}});var Ri=D((gu,Pi)=>{"use strict";var Aa=Sr().version,_e=Ae(),Er={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){Er[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var Ci={};Er.transitional=function(t,r,n){function i(s,o){return"[Axios v"+Aa+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return function(s,o,a){if(t===!1)throw new _e(i(o," has been removed"+(r?" in "+r:"")),_e.ERR_DEPRECATED);return r&&!Ci[o]&&(Ci[o]=!0,console.warn(i(o," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(s,o,a):!0}};function Ca(e,t,r){if(typeof e!="object")throw new _e("options must be an object",_e.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var s=n[i],o=t[s];if(o){var a=e[s],c=a===void 0||o(a,s,e);if(c!==!0)throw new _e("option "+s+" must be "+c,_e.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new _e("Unknown option "+s,_e.ERR_BAD_OPTION)}}Pi.exports={assertOptions:Ca,validators:Er}});var ji=D((vu,Di)=>{"use strict";var Ti=V(),Pa=hr(),qi=Bn(),Ni=$i(),bt=Or(),Ra=yr(),Ii=Ri(),Me=Ii.validators;function Le(e){this.defaults=e,this.interceptors={request:new qi,response:new qi}}Le.prototype.request=function(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=bt(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&Ii.assertOptions(n,{silentJSONParsing:Me.transitional(Me.boolean),forcedJSONParsing:Me.transitional(Me.boolean),clarifyTimeoutError:Me.transitional(Me.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(r)===!1||(s=s&&f.synchronous,i.unshift(f.fulfilled,f.rejected))});var o=[];this.interceptors.response.forEach(function(f){o.push(f.fulfilled,f.rejected)});var a;if(!s){var c=[Ni,void 0];for(Array.prototype.unshift.apply(c,i),c=c.concat(o),a=Promise.resolve(r);c.length;)a=a.then(c.shift(),c.shift());return a}for(var p=r;i.length;){var h=i.shift(),u=i.shift();try{p=h(p)}catch(l){u(l);break}}try{a=Ni(p)}catch(l){return Promise.reject(l)}for(;o.length;)a=a.then(o.shift(),o.shift());return a};Le.prototype.getUri=function(t){t=bt(this.defaults,t);var r=Ra(t.baseURL,t.url);return Pa(r,t.params,t.paramsSerializer)};Ti.forEach(["delete","get","head","options"],function(t){Le.prototype[t]=function(r,n){return this.request(bt(n||{},{method:t,url:r,data:(n||{}).data}))}});Ti.forEach(["post","put","patch"],function(t){function r(n){return function(s,o,a){return this.request(bt(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Le.prototype[t]=r(),Le.prototype[t+"Form"]=r(!0)});Di.exports=Le});var Li=D((bu,Mi)=>{"use strict";var qa=Ge();function Fe(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(i){t=i});var r=this;this.promise.then(function(n){if(!!r._listeners){var i,s=r._listeners.length;for(i=0;i<s;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,s=new Promise(function(o){r.subscribe(o),i=o}).then(n);return s.cancel=function(){r.unsubscribe(i)},s},e(function(i){r.reason||(r.reason=new qa(i),t(r.reason))})}Fe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};Fe.prototype.subscribe=function(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]};Fe.prototype.unsubscribe=function(t){if(!!this._listeners){var r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}};Fe.source=function(){var t,r=new Fe(function(i){t=i});return{token:r,cancel:t}};Mi.exports=Fe});var Bi=D((wu,Fi)=>{"use strict";Fi.exports=function(t){return function(n){return t.apply(null,n)}}});var zi=D((xu,Ui)=>{"use strict";var Na=V();Ui.exports=function(t){return Na.isObject(t)&&t.isAxiosError===!0}});var Ji=D((_u,$r)=>{"use strict";var Wi=V(),Ta=sr(),wt=ji(),Ia=Or(),Da=vt();function Hi(e){var t=new wt(e),r=Ta(wt.prototype.request,t);return Wi.extend(r,wt.prototype,t),Wi.extend(r,t),r.create=function(i){return Hi(Ia(e,i))},r}var re=Hi(Da);re.Axios=wt;re.CanceledError=Ge();re.CancelToken=Li();re.isCancel=wr();re.VERSION=Sr().version;re.toFormData=dr();re.AxiosError=Ae();re.Cancel=re.CanceledError;re.all=function(t){return Promise.all(t)};re.spread=Bi();re.isAxiosError=zi();$r.exports=re;$r.exports.default=re});var Ki=D((Ou,Vi)=>{Vi.exports=Ji()});var gs="4.9.5";var vs=Object.defineProperty,j=(e,t)=>vs(e,"name",{value:t,configurable:!0});function Et(){}j(Et,"noop");function F(e){return e==null}j(F,"isNullable");function Pe(e){return e&&typeof e=="object"&&!Array.isArray(e)}j(Pe,"isPlainObject");function ue(e,t){return Object.fromEntries(Object.entries(e).map(([r,n])=>[r,t(n,r)]))}j(ue,"valueMap");function de(e,t){return e in globalThis&&t instanceof globalThis[e]||Object.prototype.toString.call(t).slice(8,-1)===e}j(de,"is");function Se(e){return!e||typeof e!="object"?e:Array.isArray(e)?e.map(Se):de("Date",e)?new Date(e.valueOf()):de("RegExp",e)?new RegExp(e.source,e.flags):ue(e,Se)}j(Se,"clone");function Ue(e,t){return e===t?!0:typeof e!=typeof t||typeof e!="object"||!e||!t?!1:Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every((r,n)=>Ue(r,t[n])):Array.isArray(t)?!1:Object.keys({...e,...t}).every(r=>Ue(e[r],t[r]))}j(Ue,"deepEqual");function Ee(e,t,r){if(!t)return{...e};let n={};for(let i of t)(r||i in e)&&(n[i]=e[i]);return n}j(Ee,"pick");function bs(e,t){if(!t)return{...e};let r={...e};for(let n of t)Reflect.deleteProperty(r,n);return r}j(bs,"omit");function S(e,t,r){return Object.defineProperty(e,t,{writable:!0,value:r})}j(S,"defineProperty");function ws(e,t){return t.every(r=>e.includes(r))}j(ws,"contain");function xs(e,t){return e.filter(r=>t.includes(r))}j(xs,"intersection");function _s(e,t){return e.filter(r=>!t.includes(r))}j(_s,"difference");function Os(e,t){return Array.from(new Set([...e,...t]))}j(Os,"union");function Ss(e){return[...new Set(e)]}j(Ss,"deduplicate");function z(e,t){let r=e.indexOf(t);return r>=0?(e.splice(r,1),!0):!1}j(z,"remove");function te(e){return Array.isArray(e)?e:F(e)?[]:[e]}j(te,"makeArray");function $t(e){return e.charAt(0).toUpperCase()+e.slice(1)}j($t,"capitalize");function kt(e){return e.charAt(0).toLowerCase()+e.slice(1)}j(kt,"uncapitalize");function ze(e){return e.replace(/[_-][a-z]/g,t=>t.slice(1).toUpperCase())}j(ze,"camelCase");function We(e){return kt(e).replace(/_/g,"-").replace(/.[A-Z]+/g,t=>t[0]+"-"+t.slice(1).toLowerCase())}j(We,"paramCase");function Es(e){return kt(e).replace(/-/g,"_").replace(/.[A-Z]+/g,t=>t[0]+"_"+t.slice(1).toLowerCase())}j(Es,"snakeCase");var zr=ze,Wr=We;function st(e){return e.replace(/\/$/,"")}j(st,"trimSlash");function $s(e){return e.startsWith("/")||(e="/"+e),st(e)}j($s,"sanitize");var H;(e=>{e.millisecond=1,e.second=1e3,e.minute=e.second*60,e.hour=e.minute*60,e.day=e.hour*24,e.week=e.day*7;let t=new Date().getTimezoneOffset();function r(f){t=f}e.setTimezoneOffset=r,j(r,"setTimezoneOffset");function n(){return t}e.getTimezoneOffset=n,j(n,"getTimezoneOffset");function i(f=new Date,m){return typeof f=="number"&&(f=new Date(f)),m===void 0&&(m=t),Math.floor((f.valueOf()/e.minute-m)/1440)}e.getDateNumber=i,j(i,"getDateNumber");function s(f,m){let y=new Date(f*e.day);return m===void 0&&(m=t),new Date(+y+m*e.minute)}e.fromDateNumber=s,j(s,"fromDateNumber");let o=/\d+(?:\.\d+)?/.source,a=new RegExp(`^${["w(?:eek(?:s)?)?","d(?:ay(?:s)?)?","h(?:our(?:s)?)?","m(?:in(?:ute)?(?:s)?)?","s(?:ec(?:ond)?(?:s)?)?"].map(f=>`(${o}${f})?`).join("")}$`);function c(f){let m=a.exec(f);return m?(parseFloat(m[1])*e.week||0)+(parseFloat(m[2])*e.day||0)+(parseFloat(m[3])*e.hour||0)+(parseFloat(m[4])*e.minute||0)+(parseFloat(m[5])*e.second||0):0}e.parseTime=c,j(c,"parseTime");function p(f){let m=c(f);return m?f=Date.now()+m:/^\d{1,2}(:\d{1,2}){1,2}$/.test(f)?f=`${new Date().toLocaleDateString()}-${f}`:/^\d{1,2}-\d{1,2}-\d{1,2}(:\d{1,2}){1,2}$/.test(f)&&(f=`${new Date().getFullYear()}-${f}`),f?new Date(f):new Date}e.parseDate=p,j(p,"parseDate");function h(f){let m=Math.abs(f);return m>=e.day-e.hour/2?Math.round(f/e.day)+"d":m>=e.hour-e.minute/2?Math.round(f/e.hour)+"h":m>=e.minute-e.second/2?Math.round(f/e.minute)+"m":m>=e.second?Math.round(f/e.second)+"s":f+"ms"}e.format=h,j(h,"format");function u(f,m=2){return f.toString().padStart(m,"0")}e.toDigits=u,j(u,"toDigits");function l(f,m=new Date){return f.replace("yyyy",m.getFullYear().toString()).replace("yy",m.getFullYear().toString().slice(2)).replace("MM",u(m.getMonth()+1)).replace("dd",u(m.getDate())).replace("hh",u(m.getHours())).replace("mm",u(m.getMinutes())).replace("ss",u(m.getSeconds())).replace("SSS",u(m.getMilliseconds(),3))}e.template=l,j(l,"template")})(H||(H={}));var ks=Object.defineProperty,As=Object.getOwnPropertyNames,Y=(e,t)=>ks(e,"name",{value:t,configurable:!0}),Cs=(e,t)=>function(){return t||(0,e[As(e)[0]])((t={exports:{}}).exports,t),t.exports},Ps=Cs({"packages/schemastery/packages/core/src/index.ts"(e,t){var r=Symbol.for("schemastery"),n=Y(function(u){let l=Y(function(f){return n.resolve(f,l)[0]},"schema");if(u.refs){let f=ue(u.refs,y=>new n(y)),m=Y(y=>f[y],"getRef");for(let y in f){let _=f[y];_.sKey=m(_.sKey),_.inner=m(_.inner),_.list=_.list&&_.list.map(m),_.dict=_.dict&&ue(_.dict,m)}return f[u.uid]}return Object.assign(l,u),Object.defineProperty(l,"uid",{value:i++}),Object.setPrototypeOf(l,n.prototype),l.meta||={},l},"Schema"),i=0;n.prototype=Object.create(Function.prototype),n.prototype[r]=!0;var s;n.prototype.toJSON=Y(function(){if(s)return s[this.uid]??=JSON.parse(JSON.stringify({...this})),this.uid;s={[this.uid]:{...this}},s[this.uid]=JSON.parse(JSON.stringify({...this}));let l={uid:this.uid,refs:s};return s=void 0,l},"toJSON"),n.prototype.set=Y(function(l,f){return this.dict[l]=f,this},"set"),n.prototype.push=Y(function(l){return this.list.push(l),this},"push");for(let u of["required","hidden"])Object.assign(n.prototype,{[u](l=!0){let f=n(this);return f.meta={...f.meta,[u]:l},f}});n.prototype.pattern=Y(function(l){let f=n(this),m=Ee(l,["source","flags"]);return f.meta={...f.meta,pattern:m},f},"pattern");for(let u of["default","role","link","comment","description","max","min","step"])Object.assign(n.prototype,{[u](l){let f=n(this);return f.meta={...f.meta,[u]:l},f}});var o={};n.extend=Y(function(l,f){o[l]=f},"extend"),n.resolve=Y(function(l,f,m){if(!f)return[l];if(F(l)){if(f.meta.required)throw new TypeError("missing required value");let _=f.meta.default;if(F(_))return[l];l=Se(_)}let y=o[f.type];if(y)return y(l,f,m);throw new TypeError(`unsupported type "${f.type}"`)},"resolve"),n.from=Y(function(l){if(F(l))return n.any();if(["string","number","boolean"].includes(typeof l))return n.const(l).required();if(l[r])return l;if(typeof l=="function")switch(l){case String:return n.string().required();case Number:return n.number().required();case Boolean:return n.boolean().required();case Function:return n.function().required();default:return n.is(l).required()}else throw new TypeError(`cannot infer schema from ${l}`)},"from"),n.natural=Y(function(){return n.number().step(1).min(0)},"natural"),n.percent=Y(function(){return n.number().step(.01).min(0).max(1).role("slider")},"percent"),n.date=()=>n.union([n.is(Date),n.transform(n.string().role("datetime"),u=>{let l=new Date(u);if(isNaN(+l))throw new TypeError(`invalid date "${u}"`);return l})]),n.extend("any",u=>[u]),n.extend("never",u=>{throw new TypeError(`expected nullable but got ${u}`)}),n.extend("const",(u,{value:l})=>{if(u===l)return[l];throw new TypeError(`expected ${l} but got ${u}`)});function a(u,l,f){let{max:m=1/0,min:y=-1/0}=l;if(u>m)throw new TypeError(`expected ${f} <= ${m} but got ${u}`);if(u<y)throw new TypeError(`expected ${f} >= ${y} but got ${u}`)}Y(a,"checkWithinRange"),n.extend("string",(u,{meta:l})=>{if(typeof u!="string")throw new TypeError(`expected string but got ${u}`);if(l.pattern){let f=new RegExp(l.pattern.source,l.pattern.flags);if(!f.test(u))throw new TypeError(`expect string to match regexp ${f}`)}return a(u.length,l,"string length"),[u]}),n.extend("number",(u,{meta:l})=>{if(typeof u!="number")throw new TypeError(`expected number but got ${u}`);a(u,l,"number");let{step:f}=l;if(f){let m=Math.abs(u-(l.min??0))%f;if(m>=Number.EPSILON&&m<f-Number.EPSILON)throw new TypeError(`expected number multiple of ${f} but got ${u}`)}return[u]}),n.extend("boolean",u=>{if(typeof u=="boolean")return[u];throw new TypeError(`expected boolean but got ${u}`)}),n.extend("bitset",(u,{bits:l})=>{if(typeof u=="number")return[u];if(!Array.isArray(u))throw new TypeError(`expected array but got ${u}`);let f=0;for(let m of u){if(typeof m!="string")throw new TypeError(`expected string but got ${m}`);if(!(m in l))throw new TypeError(`unknown value ${m}`);f|=l[m]}return[f,f]}),n.extend("function",u=>{if(typeof u=="function")return[u];throw new TypeError(`expected function but got ${u}`)}),n.extend("is",(u,{callback:l})=>{if(u instanceof l)return[u];throw new TypeError(`expected ${l.name} but got ${u}`)});function c(u,l,f){let[m,y]=n.resolve(u[l],f);return F(y)||(u[l]=y),m}Y(c,"property"),n.extend("array",(u,{inner:l,meta:f})=>{if(!Array.isArray(u))throw new TypeError(`expected array but got ${u}`);return a(u.length,f,"array length"),[u.map((m,y)=>c(u,y,l))]}),n.extend("dict",(u,{inner:l,sKey:f},m)=>{if(!Pe(u))throw new TypeError(`expected object but got ${u}`);let y={};for(let _ in u){let $;try{$=n.resolve(_,f)[0]}catch(g){if(m)continue;throw g}y[$]=c(u,_,l),u[$]=u[_],_!==$&&delete u[_]}return[y]}),n.extend("tuple",(u,{list:l},f)=>{if(!Array.isArray(u))throw new TypeError(`expected array but got ${u}`);let m=l.map((y,_)=>c(u,_,y));return f?[m]:(m.push(...u.slice(l.length)),[m])});function p(u,l){for(let f in l)f in u||(u[f]=l[f])}Y(p,"merge"),n.extend("object",(u,{dict:l},f)=>{if(!Pe(u))throw new TypeError(`expected object but got ${u}`);let m={};for(let y in l){let _=c(u,y,l[y]);(!F(_)||y in u)&&(m[y]=_)}return f||p(m,u),[m]}),n.extend("union",(u,{list:l,toString:f})=>{let m=[];for(let y of l)try{return n.resolve(u,y)}catch{}throw new TypeError(`expected ${f()} but got ${JSON.stringify(u)}`)}),n.extend("intersect",(u,{list:l,toString:f},m)=>{let y;for(let _ of l){let $=n.resolve(u,_,!0)[0];if(!F($))if(F(y))y=$;else{if(typeof y!=typeof $)throw new TypeError(`expected ${f()} but got ${JSON.stringify(u)}`);if(typeof $=="object")y={...y,...$};else if(y!==$)throw new TypeError(`expected ${f()} but got ${JSON.stringify(u)}`)}}return!m&&Pe(u)&&p(y,u),[y]}),n.extend("transform",(u,{inner:l,callback:f})=>{let[m,y=u]=n.resolve(u,l,!0);if(Pe(u)){let _={};for(let $ in m)$ in u&&(_[$]=u[$],delete u[$]);return Object.assign(u,f(_)),[f(m)]}else return[f(m),f(y)]});function h(u,l,f){Object.assign(n,{[u](...m){let y=new n({type:u});return y.toString=f.bind(null,y),l.forEach((_,$)=>{switch(_){case"sKey":y.sKey=m[$]??n.string();break;case"inner":y.inner=n.from(m[$]);break;case"list":y.list=m[$].map(n.from);break;case"dict":y.dict=ue(m[$],n.from);break;case"bits":{y.bits={};for(let g in m[$])typeof m[$][g]=="number"&&(y.bits[g]=m[$][g]);break}default:y[_]=m[$]}}),u==="object"||u==="dict"?y.meta.default={}:u==="array"||u==="tuple"?y.meta.default=[]:u==="bitset"&&(y.meta.default=0),y}})}Y(h,"defineMethod"),h("is",["callback"],({callback:u})=>u.name),h("any",[],()=>"any"),h("never",[],()=>"never"),h("const",["value"],({value:u})=>typeof u=="string"?JSON.stringify(u):u),h("string",[],()=>"string"),h("number",[],()=>"number"),h("boolean",[],()=>"boolean"),h("bitset",["bits"],()=>"bitset"),h("function",[],()=>"function"),h("array",["inner"],({inner:u})=>`${u.toString(!0)}[]`),h("dict",["inner","sKey"],({inner:u,sKey:l})=>`{ [key: ${l.toString()}]: ${u.toString()} }`),h("tuple",["list"],({list:u})=>`[${u.map(l=>l.toString()).join(", ")}]`),h("object",["dict"],({dict:u})=>Object.keys(u).length===0?"{}":`{ ${Object.entries(u).map(([l,f])=>`${l}${f.meta.required?"":"?"}: ${f.toString()}`).join(", ")} }`),h("union",["list"],({list:u},l)=>{let f=u.map(({toString:m})=>m()).join(" | ");return l?`(${f})`:f}),h("intersect",["list"],({list:u})=>`${u.map(l=>l.toString(!0)).join(" & ")}`),h("transform",["inner","callback"],({inner:u},l)=>u.toString(l)),t.exports=n}}),R=Ps();var yn=St(ln(),1);var Ft=St(pn(),1);var mn=Object.defineProperty,ao=Object.getOwnPropertyNames,co=(e,t,r)=>t in e?mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dn=(e,t)=>mn(e,"name",{value:t,configurable:!0}),uo=(e,t)=>function(){return t||(0,e[ao(e)[0]])((t={exports:{}}).exports,t),t.exports},ae=(e,t,r)=>(co(e,typeof t!="symbol"?t+"":t,r),r),lo=uo({"packages/reggol/src/shared.ts"(e,t){var r=[6,2,3,4,5,1],n=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221];function i(a){return a instanceof Error&&Array.isArray(a.errors)}dn(i,"isAggregateError");var s=class{constructor(a){if(this.name=a,a in s.instances)return s.instances[a];s.instances[a]=this,this.createMethod("success","[S]",s.SUCCESS),this.createMethod("error","[E]",s.ERROR),this.createMethod("info","[I]",s.INFO),this.createMethod("warn","[W]",s.WARN),this.createMethod("debug","[D]",s.DEBUG)}static format(a,c){this.formatters[a]=c}static color(a,c,p,h=""){return a.colors?`\x1B[3${c<8?c:"8;5;"+c}${a.colors>=2?h:""}m${p}\x1B[0m`:""+p}static code(a,c){let p=0;for(let u=0;u<a.length;u++)p=(p<<3)-p+a.charCodeAt(u),p|=0;let h=c.colors>=2?n:c.colors>=1?r:[];return h[Math.abs(p)%h.length]}extend=a=>new s(`${this.name}:${a}`);createMethod(a,c,p){this[a]=(...h)=>{if(h.length===1&&i(h[0])){h[0].errors.forEach(l=>this[a](l));return}if(this.level<p)return;let u=Date.now();for(let l of s.targets){let f=" ".repeat(l.label?.margin??1),m=3+f.length,y="";l.showTime&&(m+=l.showTime.length+f.length,y+=s.color(l,8,H.template(l.showTime))+f);let _=this.color(l,this.name,";1"),$=(l.label?.width??0)+_.length-this.name.length;if(l.label?.align==="right"?(y+=_.padStart($)+f+c+f,m+=(l.label.width??0)+f.length):y+=c+f+_.padEnd($)+f,y+=this.format(l,m,...h),l.showDiff){let g=s.timestamp&&u-s.timestamp;y+=this.color(l," +"+H.format(g))}l.print(y)}s.timestamp=u}}color(a,c,p=""){let h=s.code(this.name,a);return s.color(a,h,c,p)}format(a,c,...p){p[0]instanceof Error?(p[0]=p[0].stack||p[0].message,p.unshift("%s")):typeof p[0]!="string"&&p.unshift("%o");let h=p.shift();h=h.replace(/%([a-zA-Z%])/g,(u,l)=>{if(u==="%%")return"%";let f=s.formatters[l];if(typeof f=="function"){let m=p.shift();return f(m,a,this)}return u}).replace(/\n/g,`
`+" ".repeat(c));for(let u of p)h+=" "+s.formatters.o(u,a,this);return h}get level(){let a=this.name.split(":"),c=s.levels;do c=c[a.shift()]??c.base;while(a.length&&typeof c=="object");return c}set level(a){let c=this.name.split(":"),p=s.levels;for(;c.length>1;){let h=c.shift(),u=p[h];typeof u=="object"?p=u:p=p[h]={base:u??p.base}}p[c[0]]=a}},o=s;dn(o,"Logger"),ae(o,"SILENT",0),ae(o,"SUCCESS",1),ae(o,"ERROR",1),ae(o,"INFO",2),ae(o,"WARN",2),ae(o,"DEBUG",3),ae(o,"timestamp",0),ae(o,"targets",[{colors:Ft.stdout&&Ft.stdout.level,print(a){console.log(a)}}]),ae(o,"formatters",Object.create(null)),ae(o,"instances",Object.create(null)),ae(o,"levels",{base:2}),o.format("s",a=>a),o.format("d",a=>+a),o.format("j",a=>JSON.stringify(a)),o.format("c",(a,c,p)=>o.color(c,o.code(p.name,c),a)),o.format("C",(a,c)=>o.color(c,15,a,";1")),t.exports=o}}),Bt=lo();var fo=Object.getOwnPropertyNames,ho=(e,t)=>function(){return t||(0,e[fo(e)[0]])((t={exports:{}}).exports,t),t.exports},po=ho({"packages/reggol/src/browser.ts"(e,t){Bt.format("o",(r,n)=>(0,yn.default)(r).replace(/\s*\n\s*/g," ")),t.exports=Bt}}),ie=po();var gn=Object.defineProperty,mo=Object.getOwnPropertyNames,yo=(e,t,r)=>t in e?gn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,go=(e,t)=>gn(e,"name",{value:t,configurable:!0}),vo=(e,t)=>function(){return t||(0,e[mo(e)[0]])((t={exports:{}}).exports,t),t.exports},bo=(e,t,r)=>(yo(e,typeof t!="symbol"?t+"":t,r),r),wo=vo({"packages/inaba/src/index.ts"(e,t){var r=class{constructor(s=Math.random){this.get=s}id(s=8,o=16){let a="";for(let c=0;c<s;++c)a+=r.chars[Math.floor(Math.random()*o)];return a}bool(s){return s>=1?!0:s<=0?!1:this.get()<s}real(...s){let o=s.length>1?s[0]:0,a=s[s.length-1];return this.get()*(a-o)+o}int(...s){return Math.floor(this.real(...s))}splice(s){return s.splice(Math.floor(this.get()*s.length),1)[0]}pick(s,o){if(o===void 0)return this.pick(s,1)[0];let a=s.slice(),c=[];o=Math.min(a.length,o);for(let p=0;p<o;p+=1)c.push(this.splice(a));return c}shuffle(s){return this.pick(s,s.length)}weightedPick(s){let o=Object.entries(s).reduce((p,[,h])=>p+h,0),a=this.get()*o,c=0;for(let p in s)if(c+=s[p],a<c)return p}},n=r;go(n,"Random"),bo(n,"chars","0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");var i=new n;for(let s of["id","bool","int","real","splice","pick","shuffle","weightedPick"])n[s]=i[s].bind(i);t.exports=n}}),Ut=wo();var xo=Object.defineProperty,J=(e,t)=>xo(e,"name",{value:t,configurable:!0});function _o(e){return typeof e=="number"&&Math.floor(e)===e}J(_o,"isInteger");async function Wt(e){return new Promise(t=>setTimeout(t,e))}J(Wt,"sleep");function Oo(e){return Object.values(e).filter(t=>typeof t=="string")}J(Oo,"enumKeys");function So(e,t,r){e[t]=r,e[r]=t}J(So,"defineEnumProperty");function vn(e,t){return Object.entries(t).forEach(([r,n])=>{if(typeof e[r]>"u")return e[r]=t[r];typeof n=="object"&&typeof e[r]=="object"&&(e[r]=vn(e[r],n))}),e}J(vn,"merge");function Eo(e,t){if(!e[t])throw new Error(`missing configuration "${t}"`);return e[t]}J(Eo,"assertProperty");function Ke(e){let{message:t,stack:r}=e instanceof Error&&e.stack?e:new Error(e),n=r.split(`
`),i=n.findIndex(s=>s.endsWith(t));return n.slice(i).join(`
`)}J(Ke,"coerce");function $o(e,t,r){e[t]=Reflect.get(e,r),Reflect.deleteProperty(e,r)}J($o,"renameProperty");var Ht=["number","string","bigint","boolean","symbol","function"],ko=["Date","RegExp","Set","Map","WeakSet","WeakMap","Array"];function Jt(e,t){return de("Date",e)?wn(e,t):Array.isArray(e)?bn(e,t):Vt(e,t)}J(Jt,"observeProperty");function zt(e){return typeof e=="symbol"||e.startsWith("$")}J(zt,"untracked");function Vt(e,t){let r=t;if(!t){let i=Object.create(null);S(e,"$diff",i),t=J(s=>{zt(s)||(i[s]=e[s])},"notify")}return new Proxy(e,{get(i,s){let o=Reflect.get(i,s);return!o||Ht.includes(typeof o)||zt(s)?o:Jt(o,r||(()=>t(s)))},set(i,s,o){let a=i[s]===o,c=Reflect.set(i,s,o);return a||!c?c:(t(s),!0)},deleteProperty(i,s){let o=!(s in i),a=Reflect.deleteProperty(i,s);return o||!a?a:(t(s),!0)}})}J(Vt,"observeObject");var Ao=["pop","shift","splice","sort"];function bn(e,t){let r={};for(let n of Ao)S(e,n,function(...i){return t(),Array.prototype[n].apply(this,i)});return new Proxy(e,{get(n,i){if(i in r)return r[i];let s=n[i];return!s||Ht.includes(typeof s)||typeof i=="symbol"||isNaN(i)?s:Jt(s,t)},set(n,i,s){return typeof i!="symbol"&&!isNaN(i)&&n[i]!==s&&t(),Reflect.set(n,i,s)}})}J(bn,"observeArray");function wn(e,t){for(let r of Object.getOwnPropertyNames(Date.prototype))r!=="valueOf"&&S(e,r,function(...n){let i=e.valueOf(),s=Date.prototype[r].apply(this,n);return e.valueOf()!==i&&t(),s});return e}J(wn,"observeDate");function Qe(e,...t){if(Ht.includes(typeof e))throw new Error(`cannot observe immutable type "${typeof e}"`);if(!e)throw new Error("cannot observe null or undefined");let r=Object.prototype.toString.call(e).slice(8,-1);if(ko.includes(r))throw new Error(`cannot observe instance of type "${r}"`);let n=Et;typeof t[0]=="function"&&(n=t.shift());let i=Vt(e,null);return S(i,"$update",J(function(){let o={...this.$diff};if(Object.keys(o).length){for(let c in this.$diff)delete this.$diff[c];return n(o)}},"$update")),S(i,"$merge",J(function(o){for(let a in o){if(a in this.$diff)throw new Error(`unresolved diff key "${a}"`);e[a]=o[a]}return this},"$merge")),i}J(Qe,"observe");var vc=new Function("template","context","pattern",`
  return template.replace(pattern || /\\{\\{([\\s\\S]+?)\\}\\}/g, (_, expr) => {
    try {
      with (context) {
        const result = eval(expr)
        return result === undefined ? '' : result
      }
    } catch {
      return ''
    }
  })
`);function qe(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}J(qe,"escapeRegExp");var Co=Object.defineProperty,W=(e,t)=>Co(e,"name",{value:t,configurable:!0});function Xt(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Date}W(Xt,"isComparable");var xn="abcdefghijklmnopqrstuvwxyz";function On(){return Array(8).fill(0).map(()=>xn[Math.floor(Math.random()*xn.length)]).join("")}W(On,"randomId");function Sn(e){return e&&Object.keys(e).some(t=>t.startsWith("$"))}W(Sn,"isEvalExpr");var Po=Symbol("expr"),Sc=Symbol("type"),U=W((e,t)=>({[Po]:!0,["$"+e]:t}),"Eval"),Xe={};Xe.$=lt;function $e(e,t){return Xe["$"+e]=t,r=>U(e,r)}W($e,"unary");function ee(e,t){return Xe["$"+e]=t,(...r)=>U(e,r)}W(ee,"multary");U.if=ee("if",([e,t,r],n)=>L(n,e)?L(n,t):L(n,r));U.ifNull=ee("ifNull",([e,t],r)=>L(r,e)??L(r,t));U.add=ee("add",(e,t)=>e.reduce((r,n)=>r+L(t,n),0));U.multiply=ee("multiply",(e,t)=>e.reduce((r,n)=>r*L(t,n),1));U.subtract=ee("subtract",([e,t],r)=>L(r,e)-L(r,t));U.divide=ee("divide",([e,t],r)=>L(r,e)/L(r,t));U.eq=ee("eq",([e,t],r)=>L(r,e).valueOf()===L(r,t).valueOf());U.ne=ee("ne",([e,t],r)=>L(r,e).valueOf()!==L(r,t).valueOf());U.gt=ee("gt",([e,t],r)=>L(r,e).valueOf()>L(r,t).valueOf());U.gte=ee("gte",([e,t],r)=>L(r,e).valueOf()>=L(r,t).valueOf());U.lt=ee("lt",([e,t],r)=>L(r,e).valueOf()<L(r,t).valueOf());U.lte=ee("lte",([e,t],r)=>L(r,e).valueOf()<=L(r,t).valueOf());U.concat=ee("concat",(e,t)=>e.map(r=>L(t,r)).join(""));U.and=ee("and",(e,t)=>e.every(r=>L(t,r)));U.or=ee("or",(e,t)=>e.some(r=>L(t,r)));U.not=$e("not",(e,t)=>!L(t,e));U.sum=$e("sum",(e,t)=>t.reduce((r,n)=>r+Te(e,n),0));U.avg=$e("avg",(e,t)=>t.reduce((r,n)=>r+Te(e,n),0)/t.length);U.max=$e("max",(e,t)=>Math.max(...t.map(r=>Te(e,r))));U.min=$e("min",(e,t)=>Math.min(...t.map(r=>Te(e,r))));U.count=$e("count",(e,t)=>new Set(t.map(r=>Te(e,r))).size);function lt(e,t){if(typeof e=="string")return lt(["_",e],t);let[r,n]=e,i=t[r];for(let s of n.split(".")){if(!i)return;i=i[s]}return i}W(lt,"getRecursive");function Gt(e,t){for(let r in e)if(r in Xe)return Xe[r](e[r],t);return e}W(Gt,"executeEvalExpr");function Te(e,t){return typeof e=="string"?lt(e,t):Gt(e,t)}W(Te,"executeAggr");function L(e,t){return Xt(t)||F(t)?t:Gt(t,e)}W(L,"executeEval");function Ro(e,t,r){for(let n in t){let i=e,s=n.split("."),o=s.pop();for(let a of s)i=i[a]||={};i[o]=L({[r]:e,_:e},t[n])}return e}W(Ro,"executeUpdate");var Kt;(e=>{e.number=["integer","unsigned","float","double","decimal"],e.string=["char","string","text"],e.boolean=["boolean"],e.date=["timestamp","date","time"],e.object=["list","json"];let t=/^(\w+)(?:\((.+)\))?$/;function r(n){if(typeof n!="string")return{initial:null,...n};let i=t.exec(n);if(!i)throw new TypeError("invalid field definition");let s=i[1],o=(i[2]||"").split(","),a={type:s};return a.initial===void 0&&(e.number.includes(a.type)&&(a.initial=0),e.string.includes(a.type)&&(a.initial=""),a.type==="list"&&(a.initial=[]),a.type==="json"&&(a.initial={})),s==="decimal"?(a.precision=+o[0],a.scale=+o[1]):o[0]&&(a.length=+o[0]),a}e.parse=r,W(r,"parse")})(Kt||(Kt={}));var En=class{constructor(e){this.name=e,this.primary="id",this.unique=[],this.foreign={}}fields={};internal={"":{}};extend(e={},t={}){let{primary:r,autoInc:n,unique:i=[],foreign:s}=t;this.primary=r||this.primary,this.autoInc=n||this.autoInc,this.unique.push(...i),Object.assign(this.foreign,s);for(let o in e)if(typeof e[o]=="function"){let a=o.lastIndexOf("."),c=o.slice(0,a+1),p=o.slice(a+1);(this.internal[c]??={})[p]=e[o]}else this.fields[o]=Kt.parse(e[o]);this.checkIndex(this.primary),this.unique.forEach(o=>this.checkIndex(o))}checkIndex(e){for(let t of te(e))if(!this.fields[t])throw new TypeError(`missing field definition for index key "${t}"`)}resolveValue(e,t){if(F(t))return t;if(this.fields[e]?.type==="time"){let r=new Date(0);return r.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),r}return t}format(e,t=!0,r="",n={}){let i=Object.keys(this.fields);return Object.entries(e).map(([s,o])=>{if(s=r+s,i.includes(s))n[s]=o;else if(!o||typeof o!="object"||Sn(o)){if(i.find(c=>s.startsWith(c+".")))n[s]=o;else if(t)throw new TypeError(`unknown field "${s}" in model ${this.name}`)}else this.format(o,t,s+".",n)}),n}parse(e){let t=Object.create(this.internal[""]);for(let r in e){let n=t,i=r.split(".").reverse(),s="";for(let o=i.length-1;o>0;o--){let a=i[o];s+=a+".",n=n[a]??=Object.create(this.internal[s]??{})}if(r in e){let o=this.resolveValue(r,e[r]);n[i[0]]=o}}return t}create(e){let t={},r=te(this.primary);for(let n in this.fields)!r.includes(n)&&!F(this.fields[n].initial)&&(t[n]=Se(this.fields[n].initial));return this.parse({...t,...e})}};W(En,"Model");var $n=W((e,t="",r={})=>new Proxy(r,{get(n,i){return typeof i=="symbol"||i.startsWith("$")?Reflect.get(n,i):$n(e,`${t}${i}.`,U("",[e,`${t}${i}`]))}}),"createRow"),Qt=class{#e;#t;driver;constructor(e,t){S(this,"driver",e),Object.assign(this,t)}get row(){return this.#e||=$n(this.ref)}get model(){return this.#t||=this.driver.model(this.table)}resolveQuery(e={}){if(typeof e=="function")return{$expr:e(this.row)};if(Array.isArray(e)||e instanceof RegExp||["string","number"].includes(typeof e)){let{primary:t}=this.model;if(Array.isArray(t))throw new TypeError("invalid shorthand for composite primary key");return{[t]:e}}return e}resolveData(e,t){e=this.model.format(e,!1);for(let r in this.model.fields)e[r]??=null;return t?this.model.parse(Ee(e,Object.keys(t))):this.model.parse(e)}resolveField(e){if(typeof e=="string")return this.row[e];if(typeof e=="function")return e(this.row)}execute(){return this.driver.execute(this)}};W(Qt,"Executable");var kn=class extends Qt{args;constructor(e,t,r){super(e),this.type="get",this.ref=On(),this.table=t,this.query=this.resolveQuery(r),this.args=[{sort:[],limit:1/0,offset:0}]}limit(e){return this.args[0].limit=e,this}offset(e){return this.args[0].offset=e,this}orderBy(e,t){return this.args[0].sort.push([this.resolveField(e),t]),this}project(e){if(Array.isArray(e)){let t=Object.keys(this.model.fields),r=e.flatMap(n=>this.model.fields[n]?n:t.filter(i=>i.startsWith(n+".")));this.fields=Object.fromEntries(r.map(n=>[n,this.row[n]]))}else this.fields=ue(e,t=>this.resolveField(t));return this}action(e,...t){return new Qt(this.driver,{...this,type:e,args:t})}evaluate(e){return this.action("eval",this.resolveField(e))}};W(kn,"Selection");function qo(e,t,r){let{limit:n,offset:i,sort:s}=t;return e.sort((o,a)=>{for(let[c,p]of s){let h=p==="asc"?1:-1,u=L({[r]:o,_:o},c),l=L({[r]:a,_:a},c);if(u<l)return-h;if(u>l)return h}return 0}),e.slice(i,i+n)}W(qo,"executeSort");var ft=class{tables=Object.create(null);drivers=Object.create(null);tasks=Object.create(null);stashed=new Set;refresh(){for(let e in this.tables)this.tasks[e]=this.prepare(e)}getDriver(e){let t=this.tables[e];return t.driver?this.drivers[t.driver]:Object.values(this.drivers)[0]}async prepare(e){return this.stashed.add(e),await this.tasks[e],new Promise(async t=>{Promise.resolve().then(async()=>{this.stashed.delete(e)&&await this.getDriver(e)?.prepare(e),t()})})}extend(e,t,r={}){let n=this.tables[e];n||(n=this.tables[e]=new En(e),n.driver=r.driver),n.extend(t,r),this.tasks[e]=this.prepare(e)}select(e,t){return new kn(this.getDriver(e),e,t)}async get(e,t,r){await this.tasks[e],Array.isArray(r)?r={fields:r}:r||(r={});let n=this.select(e,t);if(r.fields&&n.project(r.fields),r.limit!==void 0&&n.limit(r.limit),r.offset!==void 0&&n.offset(r.offset),r.sort)for(let i in r.sort)n.orderBy(i,r.sort[i]);return n.execute()}async eval(e,t,r){return await this.tasks[e],this.select(e,r).evaluate(typeof t=="function"?t:()=>t).execute()}async set(e,t,r){await this.tasks[e];let n=this.select(e,t);if(typeof r=="function"&&(r=r(n.row)),te(n.model.primary).some(s=>s in r))throw new TypeError("cannot modify primary key");await n.action("set",n.model.format(r)).execute()}async remove(e,t){await this.tasks[e],await this.select(e,t).action("remove").execute()}async create(e,t){await this.tasks[e];let r=this.select(e);return r.action("create",r.model.create(t)).execute()}async upsert(e,t,r){await this.tasks[e];let n=this.select(e);typeof t=="function"&&(t=t(n.row)),t=t.map(i=>n.model.format(i)),r=te(r||n.model.primary),await n.action("upsert",t,r).execute()}async stopAll(){let e=Object.values(this.drivers);this.drivers=Object.create(null),await Promise.all(e.map(t=>t.stop()))}async dropAll(){await Promise.all(Object.values(this.drivers).map(e=>e.drop()))}async stats(){let e={size:0,tables:{}};return await Promise.all(Object.values(this.drivers).map(async t=>{let{size:r,tables:n}=await t.stats();e.size+=r,Object.assign(e.tables,n)})),e}};W(ft,"Database");var No=class{constructor(e){this.database=e}model(e){let t=this.database.tables[e];if(t)return t;throw new TypeError(`unknown table name "${e}"`)}execute(e){let{type:t,args:r}=e;return this[t](e,...r)}};W(No,"Driver");var An=class extends Error{constructor(e,t){super(t||e.replace("-"," ")),this.code=e}name="RuntimeError";static check(e,t){return e instanceof An?!t||e.message===t:!1}};W(An,"RuntimeError");var _n={$or:(e,t)=>e.reduce((r,n)=>r||Ne(n,t),!1),$and:(e,t)=>e.reduce((r,n)=>r&&Ne(n,t),!0),$not:(e,t)=>!Ne(e,t),$exists:(e,t)=>e!==F(t),$eq:(e,t)=>t.valueOf()===e.valueOf(),$ne:(e,t)=>t.valueOf()!==e.valueOf(),$gt:(e,t)=>t.valueOf()>e.valueOf(),$gte:(e,t)=>t.valueOf()>=e.valueOf(),$lt:(e,t)=>t.valueOf()<e.valueOf(),$lte:(e,t)=>t.valueOf()<=e.valueOf(),$in:(e,t)=>e.includes(t),$nin:(e,t)=>!e.includes(t),$regex:(e,t)=>e.test(t),$regexFor:(e,t)=>new RegExp(t,"i").test(e),$bitsAllSet:(e,t)=>(e&t)===e,$bitsAllClear:(e,t)=>(e&t)===0,$bitsAnySet:(e,t)=>(e&t)!==0,$bitsAnyClear:(e,t)=>(e&t)!==e,$el:(e,t)=>t.some(r=>Ne(e,r)),$size:(e,t)=>t.length===e};function Ne(e,t){if(Array.isArray(e))return e.includes(t);if(e instanceof RegExp)return e.test(t);if(Xt(e))return t.valueOf()===e.valueOf();if(F(e))return F(t);for(let r in e)if(r in _n&&!_n[r](e[r],t))return!1;return!0}W(Ne,"executeFieldQuery");function ut(e,t,r){return Object.entries(t).every(([i,s])=>{if(i==="$and")return s.reduce((o,a)=>o&&ut(e,a,r),!0);if(i==="$or")return s.reduce((o,a)=>o||ut(e,a,r),!1);if(i==="$not")return!ut(e,s,r);if(i==="$expr")return L({[r]:e,_:e},s);try{return Ne(s,e[i])}catch{return!1}})}W(ut,"executeQuery");var Cn=Object.defineProperty,To=(e,t,r)=>t in e?Cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,G=(e,t)=>Cn(e,"name",{value:t,configurable:!0}),fe=(e,t,r)=>(To(e,typeof t!="symbol"?t+"":t,r),r);function Yt(e){return e!==null&&e!==!1&&e!==void 0}G(Yt,"isBailed");var er=class{constructor(e){this.root=e,S(this,T.current,e),S(this.on("internal/hook",function(t,r,n){let i=n?"unshift":"push",{state:s}=this[T.current],{runtime:o,disposables:a}=s;if(t==="ready"&&this.isActive)this.queue(r());else{if(t==="dispose")return a[i](r),S(r,"name","event <dispose>"),()=>z(a,r);if(t==="fork")return o.forkables[i](r),s.collect("event <fork>",()=>z(o.forkables,r))}}),T.static,e.state)}isActive=!1;_tasks=new Set;_hooks={};queue(e){let t=Promise.resolve(e).catch(r=>this.root.emit("internal/warning",r)).then(()=>this._tasks.delete(t));this._tasks.add(t)}async flush(){for(;this._tasks.size;)await Promise.all(Array.from(this._tasks))}*getHooks(e,t){let r=this._hooks[e]||[];for(let[n,i]of r.slice()){let s=t?.[T.filter];s&&!s.call(t,n)||(yield i)}}async parallel(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();await Promise.all([...this.getHooks(r,t)].map(async n=>{await n.apply(t,e)}))}emit(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t))n.apply(t,e)}async serial(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t)){let i=await n.apply(t,e);if(Yt(i))return i}}bail(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.getHooks(r,t)){let i=n.apply(t,e);if(Yt(i))return i}}register(e,t,r,n){let i=this.root.config.maxListeners;t.length>=i&&this.root.emit("internal/warning",`max listener count (${i}) for ${e} exceeded, which may be caused by a memory leak`);let s=this[T.current];return t[n?"unshift":"push"]([s,r]),s.state.collect(e,()=>this.unregister(t,r))}unregister(e,t){let r=e.findIndex(([n,i])=>i===t);if(r>=0)return e.splice(r,1),!0}on(e,t,r=!1){let n=this.bail(this,"internal/hook",e,t,r);if(n)return n;let i=this._hooks[e]||=[],s=typeof e=="string"?`event <${e}>`:"event (Symbol)";return this.register(s,i,t,r)}once(e,t,r=!1){let n=this.on(e,function(...i){return n(),t.apply(this,i)},r);return n}off(e,t){return this.unregister(this._hooks[e]||[],t)}async start(){this.isActive=!0;for(let e of this.getHooks("ready"))this.queue(e());delete this._hooks.ready,await this.flush()}async stop(){this.isActive=!1,this.root.state.clear(!0)}};G(er,"Lifecycle");fe(er,"methods",["on","once","off","before","after","parallel","emit","serial","bail","start","stop"]);function tr(e){return!(!e.prototype||e.prototype.constructor!==e)}G(tr,"isConstructor");function ht(e){return Object.getPrototypeOf(e).constructor}G(ht,"getConstructor");function Ie(e,t){if(t===!1)return;t===!0&&(t=void 0),t??={};let r=e.Config||e.schema;return r&&e.schema!==!1&&(t=r(t)),t}G(Ie,"resolveConfig");var rr=class{constructor(e,t){this.parent=e,this.config=t,this.uid=e.registry?e.registry.counter:0,this.ctx=this.context=e.extend({state:this}),this.proxy=new Proxy({},{get:(r,n)=>Reflect.get(this.config,n)})}uid;ctx;disposables=[];proxy;context;acceptors=[];get _config(){return this.runtime.isReactive?this.proxy:this.config}collect(e,t){let r=S(()=>(z(this.disposables,r),t()),"name",e);return this.disposables.push(r),r}restart(){this.clear(!0),this.start()}setup(){!this.runtime.using.length||(S(this.context.on("internal/before-service",e=>{!this.runtime.using.includes(e)||this.clear(!0)}),T.static,this),S(this.context.on("internal/service",e=>{!this.runtime.using.includes(e)||this.start()}),T.static,this))}checkDeps(){return this.runtime.using.every(e=>this.ctx[e])}clear(e=!1){this.disposables=this.disposables.splice(0,1/0).filter(t=>{if(e&&t[T.static]===this)return!0;t()})}accept(...e){let t=Array.isArray(e[0])?e.shift():null,r={keys:t,callback:e[0],...e[1]};return this.acceptors.push(r),r.immediate&&r.callback?.(this.config),this.collect(`accept <${t?.join(", ")||"*"}>`,()=>z(this.acceptors,r))}decline(e){return this.accept(e,()=>!0)}checkUpdate(e,t){if(t)return[!0,!0];let r=Object.create(null),n=G(c=>{let p=r[c]??=!Ue(this.config[c],e[c]);return s||=p,p},"checkPropertyUpdate"),i=new Set,s=!1,o=!1,a=this.runtime.isReactive||null;for(let{keys:c,callback:p,passive:h}of this.acceptors){if(!c)a||=!h;else if(h)c?.forEach(l=>i.add(l));else{let l=!1;for(let f of c)l||=n(f);if(!l)continue}p?.(e)&&(o=!0)}for(let c in{...this.config,...e})if(a!==!1&&!(c in r)&&!i.has(c)){let p=n(c);a===null&&(o||=p)}return[s,o]}};G(rr,"State");var Pn=class extends rr{constructor(e,t,r){super(e,t),this.runtime=r,this.dispose=S(e.state.collect(`fork <${e.runtime.name}>`,()=>{this.uid=null,this.clear();let n=z(r.disposables,this.dispose);return z(r.children,this)&&!r.children.length&&e.registry.delete(r.plugin),this.context.emit("internal/fork",this),n}),T.static,r),r.children.push(this),r.disposables.push(this.dispose),this.context.emit("internal/fork",this),r.isReusable&&this.setup(),this.start()}dispose;start(){if(!!this.checkDeps())for(let e of this.runtime.forkables)this.ctx.lifecycle.queue(e(this.context,this._config))}update(e,t){let r=this.config,n=this.runtime.isForkable?this:this.runtime;if(n.config!==r)return;let i=Ie(this.runtime.plugin,e),[s,o]=n.checkUpdate(i,t);this.context.emit("internal/before-update",this,e),this.config=i,n.config=i,s&&this.context.emit("internal/update",this,r),o&&n.restart()}};G(Pn,"Fork");var Zt=class extends rr{constructor(e,t,r){super(e[T.current],r),this.plugin=t,e.set(t,this),t&&this.setup()}runtime=this;schema;using=[];forkables=[];children=[];isReusable=!1;isReactive=!1;get isForkable(){return this.forkables.length>0}get name(){if(!this.plugin)return"root";let{name:e}=this.plugin;return!e||e==="apply"?"anonymous":e}fork(e,t){return new Pn(e,t,this)}dispose(){return this.uid=null,this.clear(),this.context.emit("internal/runtime",this),!0}setup(){this.schema=this.plugin.Config||this.plugin.schema,this.using=this.plugin.using||[],this.isReusable=this.plugin.reusable,this.isReactive=this.plugin.reactive,this.context.emit("internal/runtime",this),this.isReusable?this.forkables.push(this.apply):super.setup(),this.restart()}apply=(e,t)=>{if(typeof this.plugin!="function"){let r=this.plugin.apply(e,t);this.ctx.lifecycle.queue(r)}else if(tr(this.plugin)){let r=new this.plugin(e,t),n=r[T.immediate];n&&(e[n]=r),r.fork&&this.forkables.push(r.fork.bind(r))}else{let r=this.plugin(e,t);this.ctx.lifecycle.queue(r)}};clear(e){super.clear(e);for(let t of this.children)t.clear(e)}start(){if(!!this.checkDeps()){!this.isReusable&&this.plugin&&this.apply(this.context,this._config);for(let e of this.children)e.start()}}update(e,t){this.isForkable&&this.context.emit("internal/warning",`attempting to update forkable plugin "${this.plugin.name}", which may lead to unexpected behavior`);let r=this.config,n=Ie(this.runtime.plugin||ht(this.context),e),[i,s]=this.checkUpdate(n,t),o=this.children.find(a=>a.config===r);this.config=n,o&&(this.context.emit("internal/before-update",o,e),o.config=n,i&&this.context.emit("internal/update",o,r)),s&&this.restart()}};G(Zt,"Runtime");function Rn(e){return e&&typeof e=="object"&&typeof e.apply=="function"}G(Rn,"isApplicable");var nr=class extends Map{constructor(e,t){super(),this.root=e,S(this,T.current,e),e.state=new Zt(this,null,t),e.state.runtime.isReactive=!0}_counter=0;get counter(){return++this._counter}resolve(e){return e&&(typeof e=="function"?e:e.apply)}get(e){return super.get(this.resolve(e))}has(e){return super.has(this.resolve(e))}set(e,t){return super.set(this.resolve(e),t)}delete(e){e=this.resolve(e);let t=this.get(e);return t?(super.delete(e),t.dispose()):!1}using(e,t){return this.plugin({using:e,apply:t,name:t.name})}plugin(e,t){if(typeof e!="function"&&!Rn(e))throw new Error('invalid plugin, expect function or object with an "apply" method');if(t=Ie(e,t),!t)return;let r=this[T.current],n=this.get(e);return n?(n.isForkable||this.root.emit("internal/warning",`duplicate plugin detected: ${e.name}`),n.fork(r,t)):(n=new Zt(this,e,t),n.fork(r,t))}dispose(e){return this.delete(e)}};G(nr,"Registry");fe(nr,"methods",["using","plugin","dispose"]);var qn=class{constructor(e){let t=Ie(ht(this),e),r=G(n=>{if(!!n){r(Object.getPrototypeOf(n));for(let i of Object.getOwnPropertySymbols(n))this[i]=new n[i](this,t)}},"attach");this.root=this,this.mapping=Object.create(null),r(this[qn.internal]),this.state.config=t}[Symbol.for("nodejs.util.inspect.custom")](){return`Context <${this.runtime.name}>`}get events(){return this.lifecycle}extend(e={}){return Object.assign(Object.create(this),e)}isolate(e){let t=Object.create(this.mapping);for(let r of e)t[r]=Symbol(r);return this.extend({mapping:t})}},T=qn;G(T,"Context");fe(T,"config",Symbol("config"));fe(T,"events",Symbol("events"));fe(T,"static",Symbol("static"));fe(T,"filter",Symbol("filter"));fe(T,"source",Symbol("source"));fe(T,"current",Symbol("current"));fe(T,"internal",Symbol("internal"));fe(T,"immediate",Symbol("immediate"));(e=>{function t(i,s){for(let o of s.methods||[])S(e.prototype,o,function(...a){return this[i][o](...a)});for(let o of s.properties||[])Object.defineProperty(e.prototype,o,{configurable:!0,get(){return this[i][o]},set(a){this[i][o]=a}})}e.mixin=t,G(t,"mixin");function r(i,s={}){let o=typeof i=="symbol"?i:Symbol(i);if(Object.defineProperty(this.prototype,i,{configurable:!0,get(){let a=this.mapping[i]||o,c=this.root[a];if(!!c)return S(c,e.current,this),c},set(a){let c=this.mapping[i]||o,p=this.root[c];if(p===a)return;let h=Object.create(null);h[e.filter]=u=>this.mapping[i]===u.mapping[i],typeof i=="string"&&this.emit(h,"internal/before-service",i,a),this.root[c]=a,a&&typeof a=="object"&&S(a,e.source,this),typeof i=="string"&&this.emit(h,"internal/service",i,p)}}),tr(s)){let a=n(this.prototype);a[o]=s}t(i,s)}e.service=r,G(r,"service");function n(i){if(Object.prototype.hasOwnProperty.call(i,e.internal))return i[e.internal];let s=n(Object.getPrototypeOf(i));return i[e.internal]=Object.create(s)}G(n,"ensureInternal")})(T||(T={}));T.prototype[T.internal]=Object.create(null);T.service("registry",nr);T.service("lifecycle",er);T.mixin("state",{properties:["config","runtime"],methods:["collect","accept","decline"]});var ir=class{constructor(e,t,r){this.ctx=e,ht(e.root).service(t),S(this,T.current,e),r&&(this[T.immediate]=t),e.on("ready",async()=>{await Promise.resolve(),await this.start(),e[t]=this}),e.on("dispose",async()=>{e[t]=null,await this.stop()})}start(){}stop(){}get caller(){return this[T.current]}};G(ir,"Service");var kr=St(Ki(),1);var ja=Object.defineProperty,Ze=(e,t)=>ja(e,"name",{value:t,configurable:!0}),Ce=class{constructor(e,t){return Ce.create(t.request)}extend(e){return Ce.create({...this.config,...e,headers:{...this.config.headers,...e.headers}})}get(e,t){return this("GET",e,t)}delete(e,t){return this("DELETE",e,t)}post(e,t,r){return this("POST",e,{...r,data:t})}put(e,t,r){return this("PUT",e,{...r,data:t})}patch(e,t,r){return this("PATCH",e,{...r,data:t})}async head(e,t){return(await this.axios(e,{...t,method:"HEAD"})).headers}ws(e,t){return new WebSocket(e)}prepare(){return Ee(this.config,["timeout","headers"])}};Ze(Ce,"Quester");(e=>{e.isAxiosError=kr.default.isAxiosError,e.Config=R.object({timeout:R.natural().role("ms").description("")}).description("");function t(n){return R.object({endpoint:R.string().role("link").description("").default(typeof n=="string"?n:null).required(typeof n=="boolean"?n:!1),headers:R.dict(String).description(""),...this.Config.dict}).description("")}e.createConfig=t,Ze(t,"createConfig");function r(n={}){let i=st(n.endpoint||""),s=Ze(async(a,c={})=>{let p=o.prepare();return(0,kr.default)({...p,...c,url:i+a,headers:{...p.headers,...c.headers}})},"request"),o=Ze(async(a,c,p)=>(await s(c,{...p,method:a})).data,"http");Object.setPrototypeOf(o,this.prototype);for(let a of["extend","get","delete","post","put","patch","head","ws"])o[a]=this.prototype[a].bind(o);return o.config=n,o.axios=s,o}e.create=r,Ze(r,"create")})(Ce||(Ce={}));T.service("http",Ce);var Qi=Ce;var Ma=Object.defineProperty,La=Object.getOwnPropertyNames,Q=(e,t)=>Ma(e,"name",{value:t,configurable:!0}),Fa=(e,t)=>function(){return t||(0,e[La(e)[0]])((t={exports:{}}).exports,t),t.exports},Ba=Fa({"satori/packages/element/src/index.ts"(e,t){var r=Symbol("element");function n(c){return c&&typeof c=="object"&&c[r]}Q(n,"isElement");function i(c){return typeof c!="string"?c:a("text",{content:c})}Q(i,"toElement");function s(c){return Array.isArray(c)?c.map(i):typeof c=="string"?[i(c)]:c.type?[c]:c.children}Q(s,"toElementArray");var o=class{get data(){return this.attrs}toString(c=!1){if(this.type==="text")return a.escape(this.attrs.content);let p=this.children.map(u=>u.toString(c)).join("");if(!this.type||c)return p;let h=Object.entries(this.attrs).map(([u,l])=>F(l)?"":(u=Wr(u),l===""?` ${u}`:` ${u}="${a.escape(l,!0)}"`)).join("");return this.children.length?`<${this.type}${h}>${p}</${this.type}>`:`<${this.type}${h}/>`}};Q(o,"ElementConstructor"),S(o,"name","Element"),S(o.prototype,r,!0);function a(c,...p){let h=Object.create(o.prototype),u={},l=[];if(p[0]&&typeof p[0]=="object"&&!n(p[0])&&!Array.isArray(p[0]))for(let[f,m]of Object.entries(p.shift()))F(m)||(m===!0?u[f]="":m===!1?u["no"+$t(f)]="":u[f]=""+m);return p[0]&&(l=s(p[0])),Object.assign(h,{type:c,attrs:u,children:l})}Q(a,"Element"),(c=>{function p(b){return typeof b!="string"?c(null,b):c.parse(b,!0)}c.normalize=p,Q(p,"normalize");function h(b,x=!1){let k=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return x?k.replace(/"/g,"&quot;"):k}c.escape=h,Q(h,"escape");function u(b){return b.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}c.unescape=u,Q(u,"unescape");function l(b,x={}){let k=g(b);return x.caret?x.type&&k[0]?.type!==x.type?void 0:k[0]:y(k,x.type||"*")[0]}c.from=l,Q(l,"from");let f=/ *([ >+~]) */g;function m(b){return b.split(",").map(x=>{let k=[];x=x.trim();let C,A=" ";for(;C=f.exec(x);)k.push({type:x.slice(0,C.index),combinator:A}),A=C[1],x=x.slice(C.index+C[0].length);return k.push({type:x,combinator:A}),k})}c.parseSelector=m,Q(m,"parseSelector");function y(b,x){if(typeof b=="string"&&(b=g(b)),typeof x=="string"&&(x=m(x)),!x.length)return;let k=[],C=[];for(let[A,I]of b.entries()){let O=[],P=[...x,...k];k=[];let M=!1;for(let B of P){let{type:ne,combinator:it}=B[0];(ne===I.type||ne==="*")&&(B.length===1?M=!0:[" ",">"].includes(B[1].combinator)?O.push(B.slice(1)):B[1].combinator==="+"?k.push(B.slice(1)):x.push(B.slice(1))),it===" "&&O.push(B)}M&&C.push(b[A]),C.push(...y(I.children,O))}return C}c.select=y,Q(y,"select");let _=/<(\/?)\s*([^\s>/]+)([^>]*?)\s*(\/?)>/,$=/([^\s=]+)(?:="([^"]*)"|=([^"\s]+))?/g;function g(b,x=!1){let k=[],C;for(;C=_.exec(b);){C.index&&k.push(u(b.slice(0,C.index)));let[O,P,M,B,ne]=C,it={source:O,tag:M,close:P,empty:ne,attrs:{}},Br;for(;Br=$.exec(B);){let[Xa,as,cs="",us=cs]=Br;it.attrs[zr(as)]=u(us)}k.push(it),b=b.slice(C.index+C[0].length)}b&&k.push(u(b));let A=[c(null)];function I(O){for(;O>0;O--){let{children:P}=A.shift(),{source:M}=A[0].children.pop();A[0].children.push(c("text",{content:M})),A[0].children.push(...P)}}Q(I,"rollback");for(let O of k)if(typeof O=="string")A[0].children.push(c("text",{content:O}));else if(O.close){let P=0;for(;P<A.length&&A[P].type!==O.tag;)P++;if(P===A.length)A[0].children.push(c("text",{content:O.source}));else{I(P);let M=A.shift();delete M.source}}else{let P=c(O.tag,O.attrs);A[0].children.push(P),O.empty||(P.source=O.source,A.unshift(P))}return I(A.length-1),x?A[0]:A[0].children}c.parse=g,Q(g,"parse");function d(b,x){let k=typeof b=="string"?g(b):b,C=[];return k.forEach((A,I,O)=>{let P=x[A.type]??x.default??!0;if(typeof P=="function"&&(P=P(A.attrs,I,O)),P===!0){let{type:M,attrs:B,children:ne}=A;C.push(c(M,B,d(ne,x)))}else P!==!1&&C.push(...s(P))}),typeof b=="string"?C.join(""):C}c.transform=d,Q(d,"transform");async function v(b,x){let k=typeof b=="string"?g(b):b,C=(await Promise.all(k.map(async(A,I,O)=>{let P=x[A.type]??x.default??!0;if(typeof P=="function"&&(P=await P(A.attrs,I,O)),P===!0){let{type:M,attrs:B,children:ne}=A;return[c(M,B,await v(ne,x))]}else return P!==!1?s(P):[]}))).flat(1);return typeof b=="string"?C.join(""):C}c.transformAsync=v,Q(v,"transformAsync");function w(b){return b.join("")}c.join=w,Q(w,"join");function E(b,...x){return(...k)=>{let C=c(b);return x.forEach((A,I)=>{F(k[I])||(C.attrs[A]=k[I])}),k[x.length]&&Object.assign(C.attrs,k[x.length]),C}}Q(E,"createFactory");function N(b){return(x,k={})=>(de("Buffer",x)?x="base64://"+x.toString("base64"):de("ArrayBuffer",x)&&(x="base64://"+Buffer.from(x).toString("base64")),c(b,{...k,url:x}))}Q(N,"createAssetFactory"),c.at=E("at","id"),c.sharp=E("sharp","id"),c.quote=E("quote","id"),c.image=N("image"),c.video=N("video"),c.audio=N("audio"),c.file=N("file")})(a||(a={})),t.exports=a}}),oe=Ba();var Xi=Object.defineProperty,Ua=(e,t,r)=>t in e?Xi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,he=(e,t)=>Xi(e,"name",{value:t,configurable:!0}),xt=(e,t,r)=>(Ua(e,typeof t!="symbol"?t+"":t,r),r);function Oe(e,t,...r){return e.intersect(n=>r.length?r.includes(n[t]):!!n[t])}he(Oe,"property");var Ar=class{constructor(e){this.app=e,S(this,ye.current,e),e.filter=()=>!0,e.on("internal/runtime",t=>{!t.uid||(t.ctx.filter=r=>t.children.some(n=>n.ctx.filter(r)))})}get caller(){return this[ye.current]}any(){return this.caller.extend({filter:()=>!0})}never(){return this.caller.extend({filter:()=>!1})}union(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)||r(n)})}intersect(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)&&r(n)})}exclude(e){let t=this.caller,r=typeof e=="function"?e:e.filter;return this.caller.extend({filter:n=>t.filter(n)&&!r(n)})}user(...e){return Oe(this.caller,"userId",...e)}self(...e){return Oe(this.caller,"selfId",...e)}guild(...e){return Oe(this.caller,"guildId",...e)}channel(...e){return Oe(this.caller,"channelId",...e)}platform(...e){return Oe(this.caller,"platform",...e)}private(...e){return Oe(this.caller.exclude(Oe(this.caller,"guildId")),"userId",...e)}};he(Ar,"Selector");xt(Ar,"methods",["any","never","union","intersect","exclude","user","self","guild","channel","platform","private"]);var rt=class{id;bot;app;constructor(e,t){Object.assign(this,t),this.selfId=e.selfId,this.platform=e.platform,S(this,"bot",e),S(this,"app",e.ctx.root),S(this,"id",e.ctx.bots.counter)}get uid(){return`${this.platform}:${this.userId}`}get gid(){return`${this.platform}:${this.guildId}`}get cid(){return`${this.platform}:${this.channelId}`}get sid(){return`${this.platform}:${this.selfId}`}toJSON(){return Object.fromEntries(Object.entries(this).filter(([e])=>!e.startsWith("_")&&!e.startsWith("$")))}};he(rt,"Session");var _t=class{constructor(e,t){this.ctx=e,this.config=t,t.platform&&(this.platform=t.platform),t.selfId&&(this.selfId=t.selfId),this.context=e,e.bots.push(this),this.context.emit("bot-added",this),e.on("ready",()=>this.start()),e.on("dispose",()=>{z(e.bots,this),this.context.emit("bot-removed",this),this.stop()})}isBot=!0;hidden=!1;platform;selfId;internal;adapter;error;context;_status="offline";get status(){return this._status}set status(e){this._status=e,this.ctx.bots.includes(this)&&this.context.emit("bot-status-updated",this)}online(){this.status="online",this.error=null}offline(e){this.status="offline",this.error=e}async start(){if(!["connect","reconnect","online"].includes(this.status)){this.status="connect";try{await this.context.parallel("bot-connect",this),await this.adapter.start(this)}catch(e){this.offline(e)}}}async stop(){if(!["disconnect","offline"].includes(this.status)){this.status="disconnect";try{await this.context.parallel("bot-disconnect",this),await this.adapter.stop(this)}catch(e){this.context.emit("internal/warning",e),this.offline()}}}get sid(){return`${this.platform}:${this.selfId}`}session(e){return new rt(this,e)}dispatch(e){if(!this.ctx.lifecycle.isActive)return;let t=[e.type];e.subtype&&(t.unshift(t[0]+"/"+e.subtype),e.subsubtype&&t.unshift(t[0]+"/"+e.subsubtype));for(let r of t)this.context.emit(e,r,e)}};he(_t,"Bot");xt(_t,"reusable",!0);var et=new ie("adapter"),tt=class{async start(e){}async stop(e){}};he(tt,"Adapter");xt(tt,"schema",!1);(e=>{class t extends e{constructor(s,o){super(),this.ctx=s,this.bot=o,o.adapter=this}static reusable=!0}he(t,"Client"),e.Client=t;class r extends e{bots=[];fork(s,o){o.adapter=this,this.bots.push(o),s.on("dispose",()=>{z(this.bots,o)})}}he(r,"Server"),e.Server=r;class n extends e.Client{static reusable=!0;static Config=R.object({retryTimes:R.natural().description("").default(6),retryInterval:R.natural().role("ms").description("").default(5*H.second),retryLazy:R.natural().role("ms").description("").default(H.minute)}).description("");async start(s){let o=0,{retryTimes:a,retryInterval:c,retryLazy:p}=s.config,h=he(async(u=!1)=>{et.debug("websocket client opening");let l=await this.prepare(s),f=l.url.replace(/\?.+/,"");l.onerror=m=>et.debug(m),l.onclose=({code:m,reason:y})=>{if(s.socket=null,et.debug(`websocket closed with ${m}`),s.status==="disconnect")return s.status="offline";let _=y.toString()||`failed to connect to ${f}, code: ${m}`,$=c;if(o>=a){if(u)return s.error=new Error(_),s.status="offline";$=p}o++,s.status="reconnect",et.warn(`${_}, will retry in ${H.format($)}...`),setTimeout(()=>{s.status==="reconnect"&&h()},$)},l.onopen=()=>{o=0,s.socket=l,et.info("connect to server: %c",f),this.accept(s)}},"reconnect");h(!0)}async stop(s){s.socket?.close()}}he(n,"WsClient"),e.WsClient=n})(tt||(tt={}));var ye=class extends T{constructor(e){super(e)}};he(ye,"Context");xt(ye,"session",Symbol("session"));rt.prototype[ye.filter]=function(e){return e.filter(this)};ye.service("__selector__",Ar);ye.service("bots",class{constructor(e){let t=[],r=0;return new Proxy(t,{get(n,i){return i in n||typeof i=="symbol"?n[i]:i==="counter"?r++:t.find(s=>s.sid===i)},deleteProperty(n,i){if(i in n||typeof i=="symbol")return delete n[i];let s=n.findIndex(o=>o.sid===i);return s<0?!1:(n.splice(s,1),!0)}})}});var es=Object.defineProperty,za=(e,t,r)=>t in e?es(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t)=>es(e,"name",{value:t,configurable:!0}),ve=(e,t,r)=>(za(e,typeof t!="symbol"?t+"":t,r),r),Yu=ir,X=class extends ye{constructor(e){super(e)}get app(){return this.root}get options(){return this.root.config}};q(X,"Context");(e=>{e.Config=R.intersect([]),S(e.Config,"Basic",R.object({locale:R.string().default("zh").description(""),prefix:R.union([R.array(String),R.transform(String,t=>[t]),R.function()]).default([""]).description(""),nickname:R.union([R.array(String),R.transform(String,t=>[t])]).description(""),autoAssign:R.union([Boolean,Function]).default(!0).description(""),autoAuthorize:R.union([R.natural(),Function]).default(1).description("")}).description("")),S(e.Config,"Message",R.object({delay:R.object({character:R.natural().role("ms").default(0).description(" `session.sendQueued()` "),message:R.natural().role("ms").default(.1*H.second).description(" `session.sendQueued()` "),cancel:R.natural().role("ms").default(0).description(" `session.cancelQueued()` "),broadcast:R.natural().role("ms").default(.5*H.second).description(" `bot.broadcast()` "),prompt:R.natural().role("ms").default(H.minute).description(" `session.prompt()` ")})}).description("")),S(e.Config,"Advanced",R.object({prettyErrors:R.boolean().default(!0).description(" Koishi "),maxListeners:R.natural().default(64).description("Koishi ")}).description("")),e.Config.list.push(e.Config.Basic,e.Config.Message,e.Config.Advanced)})(X||(X={}));function Wa(e){return e}q(Wa,"defineConfig");var Mr=class{constructor(e){this.app=e,S(this,X.current,e),e.on("internal/warning",(t,...r)=>{this.logger("app").warn(t,...r)})}get caller(){return this[X.current]}logger(e){return new ie(e)}async waterfall(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.app.lifecycle.getHooks(r,t)){let i=await n.apply(t,e);e[0]=i}return e[0]}chain(...e){let t=typeof e[0]=="object"?e.shift():null,r=e.shift();for(let n of this.app.lifecycle.getHooks(r,t)){let i=n.apply(t,e);e[0]=i}return e[0]}before(e,t,r=!1){let n=e.split("/");return n[n.length-1]="before-"+n[n.length-1],this.caller.on(n.join("/"),t,!r)}createTimerDispose(e){let t=q(()=>{if(clearTimeout(e),!!this.caller.state)return z(this.caller.state.disposables,t)},"dispose");return this.caller.state.disposables.push(t),t}setTimeout(e,t,...r){let n=this.createTimerDispose(setTimeout(()=>{n(),e()},t,...r));return n}setInterval(e,t,...r){return this.createTimerDispose(setInterval(e,t,...r))}};q(Mr,"SelectorService");ve(Mr,"methods",["chain","waterfall","before","logger","setTimeout","setInterval"]);X.service("selector",Mr);var Pr=`"'`,Rr=`"'`,Be;(e=>{let t={};function r(g,d,v){t[g]={terminator:d,parse:v}}e.interpolate=r,q(r,"interpolate"),r("$(",")");let n;(g=>{g.unescape=q(d=>d.replace(/@__KOISHI_SPACE__@/g," ").replace(/@__KOISHI_NOLINE__@/g,`
`).replace(/@__KOISHI_RETURN__@/g,"\r").replace(/@__KOISHI_TAB__@/g,"	"),"unescape"),g.escape=q(d=>d.replace(/ /g,"@__KOISHI_SPACE__@").replace(/\n/g,"@__KOISHI_NOLINE__@").replace(/\r/g,"@__KOISHI_RETURN__@").replace(/\t/g,"@__KOISHI_TAB__@"),"escape")})(n=e.whitespace||(e.whitespace={}));class i{bracs;constructor(){this.bracs=Object.create(t)}interpolate(d,v,w){this.bracs[d]={terminator:v,parse:w}}parseToken(d,v="$"){let w={inters:[]},E=Pr.indexOf(d[0]),N=Rr[E],b="";N&&(d=d.slice(1),v=`${N}(?=${v})|$`),v+=`|${Object.keys({...this.bracs,...t}).map(qe).join("|")}`;let x=new RegExp(v);for(;;){let k=x.exec(d);if(b+=n.unescape(d.slice(0,k.index)),k[0]in this.bracs){d=d.slice(k.index+k[0].length).trimStart();let{parse:C,terminator:A}=this.bracs[k[0]],I=C?.(d)||this.parse(d,A);d=I.rest,w.inters.push({...I,pos:b.length,initiator:k[0]})}else{let C=k[0]===N,A=d.slice(k.index+ +C);return w.rest=A.trimStart(),w.quoted=C,w.terminator=k[0],C?w.terminator+=A.slice(0,-w.rest.length):N&&(b=Pr[E]+b,w.inters.forEach(I=>I.pos+=1)),w.content=b,N==="'"&&e.revert(w),w}}}parse(d,v=""){let w=[];d=oe.parse(d).map(x=>x.type==="text"?x.toString():n.escape(x.toString())).join("");let E=d,N="",b=`\\s+|[${qe(v)}]|$`;for(;E&&!(v&&E.startsWith(v));){let x=this.parseToken(E,b);w.push(x),E=x.rest,N=x.terminator,delete x.rest}return E.startsWith(v)&&(E=E.slice(1)),d=d.slice(0,-(E+N).length),E=n.unescape(E),d=n.unescape(d),{tokens:w,rest:E,source:d}}stringify(d){let v=d.tokens.reduce((w,E)=>(E.quoted&&(w+=Pr[Rr.indexOf(E.terminator[0])]||""),w+E.content+E.terminator),"");return d.rest&&!Rr.includes(v[v.length-1])||d.initiator?v.slice(0,-1):v}}q(i,"Tokenizer"),e.Tokenizer=i;let s=new i;function o(g,d=""){return s.parse(g,d)}e.parse=o,q(o,"parse");function a(g){return s.stringify(g)}e.stringify=a,q(a,"stringify");function c(g){for(;g.inters.length;){let{pos:d,source:v,initiator:w}=g.inters.pop();g.content=g.content.slice(0,d)+w+v+t[w].terminator+g.content.slice(d)}}e.revert=c,q(c,"revert");function p(g){return typeof g=="string"?l[g]||{}:{}}q(p,"resolveConfig");let h=Array.isArray;function u(g){return typeof g=="function"?g:g instanceof RegExp?d=>{if(g.test(d))return d;throw new Error}:h(g)?d=>{if(g.includes(d))return d;throw new Error}:l[g]?.transform}q(u,"resolveType");let l={};function f(g,d,v){l[g]={...v,transform:d}}e.createDomain=f,q(f,"createDomain"),f("string",g=>g),f("text",g=>g,{greedy:!0}),f("rawtext",g=>oe.unescape(g),{greedy:!0}),f("boolean",()=>!0),f("number",(g,d)=>{let v=+g;if(Number.isFinite(v))return v;throw new Error("internal.invalid-number")}),f("integer",(g,d)=>{let v=+g;if(v*0===0&&Math.floor(v)===v)return v;throw new Error("internal.invalid-integer")}),f("posint",(g,d)=>{let v=+g;if(v*0===0&&Math.floor(v)===v&&v>0)return v;throw new Error("internal.invalid-posint")}),f("natural",(g,d)=>{let v=+g;if(v*0===0&&Math.floor(v)===v&&v>=0)return v;throw new Error("internal.invalid-natural")}),f("date",(g,d)=>{let v=H.parseDate(g);if(+v)return v;throw new Error("internal.invalid-date")}),f("user",(g,d)=>{if(g.startsWith("@"))return g=g.slice(1),g.includes(":")?g:`${d.platform}:${g}`;let v=oe.from(g);if(v&&v.type==="at")return`${d.platform}:${v.data.id}`;throw new Error("internal.invalid-user")}),f("channel",(g,d)=>{if(g.startsWith("#"))return g=g.slice(1),g.includes(":")?g:`${d.platform}:${g}`;let v=oe.from(g);if(v&&v.type==="sharp")return`${d.platform}:${v.data.id}`;throw new Error("internal.invalid-channel")});let m=/<[^>]+>|\[[^\]]+\]/g;function y(g){let d,v=[];for(;d=m.exec(g);){let w=d[0].slice(1,-1),E=!1;w.startsWith("...")&&(w=w.slice(3),E=!0);let[N,b]=w.split(":"),x=b?b.trim():void 0;v.push({name:N,variadic:E,type:x,required:d[0][0]==="<"})}return v.stripped=g.replace(/:[\w-]+[>\]]/g,w=>w.slice(-1)).trimEnd(),v}q(y,"parseDecl");function _(g,d,v,w,E={}){let{name:N,type:b}=E,x=u(b);if(x)try{return x(g,w.session)}catch(C){if(!w.session)w.error=`internal.invalid-${v}`;else{let A=w.session.text(C.message||"internal.check-syntax");w.error=w.session.text(`internal.invalid-${v}`,[N,A])}return}if(g===""&&!d)return!0;if(d)return g;let k=+g;return k*0===0?k:g}e.parseValue=_,q(_,"parseValue");class ${constructor(d,v,w){if(this.name=d,this.ctx=w,!d)throw new Error("expect a command name");let E=this._arguments=y(v);this.declaration=E.stripped}declaration;_arguments;_options={};_namedOptions={};_symbolicOptions={};_createOption(d,v,w){let E=/^((?:-[\w-]*|[^<[\s\w\x80-\uffff])(?:,\s*(?:-[\w-]*|[^<[\s\w\x80-\uffff]))*)?((?:\s*\[[^\]]+?\]|\s*<[^>]+?>)*)(.*)$/.exec(v),N=We(d),b=E[1]||"--"+N,x=E[2]||"",k=E[3].trim(),C=[],A=[];for(let B of b.trim().split(",")){B=B.trimStart();let ne=B.replace(/^-+/,"");!ne||!B.startsWith("-")?A.push(B):C.push(ne)}!("value"in w)&&!C.includes(N)&&(b+=", --"+N);let I=y(x.trimStart());I.stripped&&(b+=" "+I.stripped);let O=this._options[d]||={...pe.defaultOptionConfig,...I[0],...w,name:d,values:{},valuesSyntax:{},variants:{},syntax:b},P=`commands.${this.name}.options.${d}`,M=typeof O.fallback;"value"in w?(P+="."+w.value,O.variants[w.value]={...w,syntax:b},O.valuesSyntax[w.value]=b,C.forEach(B=>O.values[B]=w.value)):x.trim()?!O.type&&(M==="string"||M==="number")&&(O.type=M):O.type="boolean",k&&this.ctx.i18n.define("",P,k),this._assignOption(O,C,this._namedOptions),this._assignOption(O,A,this._symbolicOptions),this._namedOptions[N]||(this._namedOptions[N]=O)}_assignOption(d,v,w){for(let E of v){if(E in w)throw new Error(`duplicate option name "${E}" for command "${this.name}"`);w[E]=d}}removeOption(d){if(!this._options[d])return!1;let v=this._options[d];delete this._options[d];for(let w in this._namedOptions)this._namedOptions[w]===v&&delete this._namedOptions[w];for(let w in this._symbolicOptions)this._symbolicOptions[w]===v&&delete this._symbolicOptions[w];return!0}parse(d,v,w=[],E={}){for(typeof d=="string"&&(d=e.parse(d,v)),!d.source&&d.tokens&&(d.source=this.name+" "+e.stringify(d));!d.error&&d.tokens?.length;){let N=d.tokens[0],{content:b,quoted:x}=N,k=this._arguments[w.length];if(b[0]!=="-"&&p(k?.type).greedy){w.push(e.parseValue(e.stringify(d),!0,"argument",d,k));break}d.tokens.shift();let C,A,I;if(!x&&(C=this._symbolicOptions[b]))A=[We(C.name)];else{if(b[0]!=="-"||x){w.push(e.parseValue(b,x,"argument",d,k||{type:"string"}));continue}let O=0,P;for(;O<b.length&&b.charCodeAt(O)===45;++O);if(b.slice(O,O+3)==="no-"&&!this._namedOptions[b.slice(O)]){P=b.slice(O+3),E[ze(P)]=!1;continue}let M=O+1;for(;M<b.length&&b.charCodeAt(M)!==61;M++);P=b.slice(O,M),A=O>1?[P]:P,I=b.slice(++M),C=this._namedOptions[A[A.length-1]]}if(x=!1,!I){let{type:O}=C||{};if(p(O).greedy)I=e.stringify(d),x=!0,d.tokens=[];else if(O!=="boolean"&&d.tokens.length&&(O||d.tokens[0]?.content!=="-")){let P=d.tokens.shift();I=P.content,x=P.quoted}}for(let O=0;O<A.length;O++){let P=A[O],M=this._namedOptions[P],B=M?M.name:ze(P);if(M&&P in M.values)E[B]=M.values[P];else{let ne=O+1<A.length?"":I;E[B]=e.parseValue(ne,x,"option",d,M)}if(d.error)break}}for(let{name:N,fallback:b}of Object.values(this._options))b!==void 0&&!(N in E)&&(E[N]=b);return delete d.tokens,{...d,options:E,args:w,error:d.error||"",command:this}}stringifyArg(d){return d=""+d,d.includes(" ")?`"${d}"`:d}stringify(d,v){let w=this.name;for(let E in v){let N=v[E];N===!0?w+=` --${E}`:N===!1?w+=` --no-${E}`:w+=` --${E} ${this.stringifyArg(N)}`}for(let E of d)w+=" "+this.stringifyArg(E);return w}}q($,"CommandBase"),e.CommandBase=$})(Be||(Be={}));var Nr;(e=>{let t;(r=>{r[r.ignore=1]="ignore"})(t=e.Flag||(e.Flag={})),e.fields=[]})(Nr||(Nr={}));var Tr;(e=>{let t;(r=>{r[r.ignore=1]="ignore",r[r.silent=4]="silent"})(t=e.Flag||(e.Flag={})),e.fields=[]})(Tr||(Tr={}));var Ot=class extends ft{constructor(e){super(),this.app=e,S(this,X.current,e),this.extend("user",{id:"string(63)",name:{type:"string",length:63},flag:"unsigned(20)",authority:"unsigned(4)",locale:"string(63)"},{autoInc:!0}),this.extend("channel",{id:"string(63)",platform:"string(63)",flag:"unsigned(20)",assignee:"string(63)",guildId:"string(63)",locale:"string(63)"},{primary:["id","platform"]}),e.on("bot-added",t=>{t.platform in this.tables.user.fields||this.extend("user",{[t.platform]:{type:"string",length:63}},{unique:[t.platform]})})}async getUser(e,t,r){let n=await this.get("user",{[e]:t},r);return Array.isArray(t)?n:(n[0]&&Object.assign(n[0],{[e]:t}),n[0])}setUser(e,t,r){return this.set("user",{[e]:t},r)}createUser(e,t,r){return this.create("user",{[e]:t,...r})}async getChannel(e,t,r){let n=await this.get("channel",{platform:e,id:t},r);return Array.isArray(t)?n:(n[0]&&Object.assign(n[0],{platform:e,id:t}),n[0])}getSelfIds(e,t){if(e)return t||=this.app.bots.filter(n=>n.platform===e).map(n=>n.selfId),{[e]:t};let r={};for(let n of this.app.bots)(r[n.platform]||=[]).push(n.selfId);return r}async getAssignedChannels(e,t=this.getSelfIds()){return this.get("channel",{$or:Object.entries(t).map(([r,n])=>({platform:r,assignee:n}))},e)}setChannel(e,t,r){return this.set("channel",{platform:e,id:t},r)}createChannel(e,t,r){return this.create("channel",{platform:e,id:t,...r})}async broadcast(...e){let t;Array.isArray(e[0])&&(t=e.shift());let[r,n]=e;if(!r)return[];let i=await this.getAssignedChannels(["id","assignee","flag","platform","guildId"]),s={};for(let{id:o,assignee:a,flag:c,platform:p,guildId:h}of i)t&&!t.includes(`${p}:${o}`)||!n&&c&4||((s[p]||={})[a]||=[]).push([o,h]);return(await Promise.all(Object.entries(s).flatMap(([o,a])=>this.app.bots.map(c=>c.platform!==o?Promise.resolve([]):c.broadcast(a[c.selfId]||[],r))))).flat(1)}};q(Ot,"DatabaseService");ve(Ot,"methods",["getSelfIds","broadcast"]);Ot.prototype.extend=q(function(t,r,n){ft.prototype.extend.call(this,t,r,{...n,driver:this[X.current].mapping.database}),this.app.emit("model",t)},"extend");X.service("database");X.service("model",Ot);var ul=q((e,t,r)=>({name:e.name,reusable:!0,Config:t,apply(n,i){i={...i},r?.(n,i);let s=new e(n.model,i),o=n.mapping.database||"default";n.on("ready",async()=>{await s.start(),n.model.drivers[o]=s,n.model.refresh();let a=Object.create(n.model);n.database=a}),n.on("dispose",async()=>{n.database=null,delete n.model.drivers[o],await s.stop()})}}),"defineDriver");function ts(e,t="",r=""){return e.length?new RegExp(`^${t}(${e.map(qe).join("|")})${r}`):/$^/}q(ts,"createLeadingRE");var ge;(e=>{e.MAX_DEPTH=64;async function t(r,n){return typeof r=="function"?r(n):r}e.compose=t,q(t,"compose")})(ge||(ge={}));var Lr=class{constructor(e,t){this.ctx=e,this.config=t,S(this,X.current,e),this.prepare(),this.middleware(this._process.bind(this)),e.on("message",this._handleMessage.bind(this)),e.before("attach-user",(r,n)=>{r.collect("user",r.argv,n)}),e.before("attach-channel",(r,n)=>{r.collect("channel",r.argv,n)}),this.middleware((r,n)=>r.resolve(r.argv)?r.execute(r.argv,n):n())}_hooks=[];_nameRE;_sessions=Object.create(null);_userCache=new Ir;_channelCache=new Ir;get caller(){return this[X.current]}middleware(e,t=!1){return this.caller.lifecycle.register("middleware",this._hooks,e,t)}prepare(){this._nameRE=ts(te(this.config.nickname),"@?","([,]\\s*|\\s+)")}_resolvePrefixes(e){let t=e.resolveValue(this.config.prefix);return Array.isArray(t)?t:[t||""]}_stripNickname(e){e.startsWith("@")&&(e=e.slice(1));for(let t of te(this.config.nickname)){if(!e.startsWith(t))continue;let r=e.slice(t.length),n=/^([,]\s*|\s+)/.exec(r);if(!!n)return r.slice(n[0].length)}}async _process(e,t){let r=!1,n=!1,i=null,s=e.content.trim();if(e.elements??=oe.parse(s),e.subtype!=="private"&&e.elements[0]?.type==="at"&&e.elements[0].attrs.id===e.selfId)r=n=!0,s=e.elements.slice(1).join("").trimStart();else{let o=this._stripNickname(s);o&&(n=!0,s=o)}for(let o of this._resolvePrefixes(e))!s.startsWith(o)||(i=o,s=s.slice(o.length));if(S(e,"parsed",{content:s,appel:n,prefix:i}),this.ctx.emit(e,"before-attach",e),this.ctx.database){if(e.subtype==="group"){let c=new Set(["flag","assignee","guildId","locale"]);this.ctx.emit("before-attach-channel",e,c);let p=await e.observeChannel(c);if(p.guildId=e.guildId,await this.ctx.serial(e,"attach-channel",e)||p.flag&Tr.Flag.ignore||p.assignee!==e.selfId&&!r)return}let o=new Set(["flag","authority","locale"]);this.ctx.emit("before-attach-user",e,o);let a=await e.observeUser(o);if(await this.ctx.serial(e,"attach-user",e)||a.flag&Nr.Flag.ignore)return}return this.ctx.emit(e,"attach",e),t()}async _handleMessage(e){if(e.selfId===e.userId)return;this._sessions[e.id]=e;let t=this._hooks.filter(([a])=>a.filter(e)).map(([,a])=>a.bind(null,e)),r=0,n="",i="",{prettyErrors:s}=this.ctx.root.config,o=q(async a=>{if(s&&(i=new Error().stack.split(`
`,3)[2],r)){let c=i.match(/\((.+)\)/);n=`
  - ${c?c[1]:i.slice(7)}${n}`}try{if(!this._sessions[e.id])throw new Error("isolated next function detected");if(a!==void 0&&(t.push(c=>ge.compose(a,c)),t.length>ge.MAX_DEPTH))throw new Error(`middleware stack exceeded ${ge.MAX_DEPTH}`);return await t[r++]?.(o)}catch(c){let p=Ke(c);if(s){let h=p.indexOf(i);h>=0?p=p.slice(0,h):p+=`
`,p+=`Middleware stack:${n}`}this.ctx.logger("session").warn(`${e.content}
${p}`)}},"next");try{let a=await o();a&&await e.send(a)}finally{delete this._sessions[e.id],this.ctx.emit(e,"middleware",e),this._userCache.delete(e.id),this._channelCache.delete(e.id),await e.user?.$update(),await e.channel?.$update(),await e.guild?.$update()}}};q(Lr,"Internal");ve(Lr,"methods",["middleware"]);X.service("$internal",Lr);var Ir=class{#e=Object.create(null);get(e,t){let r=this.#e[t];if(!!r)return r.refs.add(e),r.value}set(e,t,r){let n=this.#e[t];n?n.value=r:n=this.#e[t]={value:r,key:t,refs:new Set},n.refs.add(e)}delete(e){for(let t in this.#e){let{refs:r}=this.#e[t];r.delete(e),r.size||delete this.#e[t]}}};q(Ir,"SharedCache");var qr=new ie("command"),rs=class extends Be.CommandBase{config;children=[];parent=null;_aliases=[];_examples=[];_usage;_disposed;_disposables;_userFields=[["locale"]];_channelFields=[["locale"]];_actions=[];_checkers=[async e=>this.ctx.serial(e.session,"command/before-execute",e)];static userFields(e){return this._userFields.push(e),this}static channelFields(e){return this._channelFields.push(e),this}constructor(e,t,r){super(e,t,r),this.config={...rs.defaultConfig},this._registerAlias(e),r.$commander._commandList.push(this)}get displayName(){return this._aliases[0]}set displayName(e){this._registerAlias(e,!0)}_registerAlias(e,t=!1){if(e=e.toLowerCase(),this._aliases.includes(e)){t&&(z(this._aliases,e),this._aliases.unshift(e));return}else t?this._aliases.unshift(e):this._aliases.push(e);let n=this.ctx.$commander.getCommand(e);if(!n)this.ctx.$commander._commands.set(e,this);else if(n!==this)throw new Error(`duplicate command names: "${e}"`);this._disposables?.push(()=>{z(this._aliases,e),this.ctx.$commander._commands.delete(e)})}[Symbol.for("nodejs.util.inspect.custom")](){return`Command <${this.name}>`}userFields(e){return this._userFields.push(e),this}channelFields(e){return this._channelFields.push(e),this}alias(...e){if(this._disposed)return this;for(let t of e)this._registerAlias(t);return this}shortcut(e,t={}){return this._disposed?this:(t.name=e,t.command=this,this.ctx.$commander._shortcuts.push(t),this._disposables?.push(()=>z(this.ctx.$commander._shortcuts,t)),this)}subcommand(e,...t){e=this.name+(e.charCodeAt(0)===46?"":"/")+e;let r=typeof t[0]=="string"?t.shift():"",n=t[0]||{};return this._disposed&&(n.patch=!0),this.ctx.command(e,r,n)}usage(e){return this._usage=e,this}example(e){return this._examples.push(e),this}option(e,...t){let r="";typeof t[0]=="string"&&(r=t.shift());let n=t[0];return this._createOption(e,r,n||{}),this._disposables?.push(()=>this.removeOption(e)),this}match(e){let{authority:t=1/0}=e.user||{};return this.ctx.filter(e)&&this.config.authority<=t}getConfig(e,t){let r=this.config[e];return typeof r=="function"?r(t):r}check(e,t=!1){return this.before(e,t)}before(e,t=!1){return t?this._checkers.push(e):this._checkers.unshift(e),this._disposables?.push(()=>z(this._checkers,e)),this}action(e,t=!1){return t?this._actions.unshift(e):this._actions.push(e),this._disposables?.push(()=>z(this._actions,e)),this}use(e,...t){return e(this,...t)}async execute(e,t=ge.compose){e.command??=this,e.args??=[],e.options??={};let{args:r,options:n,error:i}=e;if(i)return i;qr.level>=3&&qr.debug(e.source||=this.stringify(r,n));for(let c of this._checkers){let p=await c.call(this,e,...r);if(typeof p=="string")return p}if(!this._actions.length)return"";let s=0,o=this._actions.map(c=>async()=>await c.call(this,e,...r));o.push(t);let a=o.length;e.next=async c=>{if(c!==void 0&&(o.push(p=>ge.compose(c,p)),o.length>ge.MAX_DEPTH))throw new Error(`middleware stack exceeded ${ge.MAX_DEPTH}`);return o[s++]?.(e.next)};try{let c=await e.next();if(!F(c))return c}catch(c){if(s===a)throw c;let p=Ke(c);qr.warn(`${e.source||=this.stringify(r,n)}
${p}`),this.ctx.emit(e.session,"command-error",e,c)}return""}dispose(){this._disposed=!0,this.ctx.emit("command-removed",this);for(let e of this.children.slice())e.dispose();this.ctx.$commander._shortcuts=this.ctx.$commander._shortcuts.filter(e=>e.command!==this),this._aliases.forEach(e=>this.ctx.$commander._commands.delete(e)),z(this.ctx.$commander._commandList,this),this.parent&&z(this.parent.children,this)}},pe=rs;q(pe,"Command");ve(pe,"defaultConfig",{authority:1,showWarning:!0});ve(pe,"defaultOptionConfig",{authority:0});ve(pe,"_userFields",[]);ve(pe,"_channelFields",[]);(e=>{e.Config=R.object({authority:R.union([R.natural(),R.function()]).default(1),hidden:R.boolean().default(!1),checkArgCount:R.boolean().default(!1),checkUnknown:R.boolean().default(!1)})})(pe||(pe={}));function ns(e){e.before("parse",(t,r)=>{let n=Be.parse(t);return r.quote&&n.tokens.push({content:r.quote.content,quoted:!0,inters:[],terminator:""}),n}),e.before("parse",(t,r)=>{let{parsed:n,quote:i}=r;if(!(n.prefix||i))for(let s of e.$commander._shortcuts){let{name:o,fuzzy:a,command:c,prefix:p,options:h={},args:u=[]}=s;if(!(p&&!n.appel||!c.ctx.filter(r)))if(typeof o=="string"){if(!a&&t!==o||!t.startsWith(o))continue;let l=t.slice(o.length);if(a&&!n.appel&&l.match(/^\S/))continue;let f=Be.parse(l.trim());return f.session=r,c.parse(f,"",[...u],{...h})}else{let l=function(m){return typeof m!="string"?m:(m=m.replace(/\$\$/g,"@@__PLACEHOLDER__@@"),f.forEach((y,_)=>{!_||_>9||(m=m.replace(new RegExp(`\\$${_}`,"g"),(y||"").replace(/\$/g,"@@__PLACEHOLDER__@@")))}),m.replace(/@@__PLACEHOLDER__@@/g,"$"))};q(l,"escape");let f=o.exec(t);if(!f)continue;return c.parse({args:u.map(l),options:ue(h,l)})}}}),e.before("attach",t=>{S(t,"argv",e.bail("before-parse",t.parsed.content,t)),t.argv.root=!0,t.argv.session=t})}q(ns,"runtime");function is(e){e.on("command-added",t=>{t.userFields(({tokens:r,command:n,options:i={}},s)=>{if(!n)return;let{authority:o}=n.config,a=o>0;for(let{name:c,authority:p}of Object.values(n._options))c in i?p>0&&(a=!0):r&&p>0&&(a=!0);a&&s.add("authority")})}),e.before("command/execute",t=>{let{session:r,options:n,command:i}=t;if(!r.user)return;function s(o,...a){return i.config.showWarning?r.text(o,a):""}if(q(s,"sendHint"),typeof r.user.authority=="number"&&i.getConfig("authority",r)>r.user.authority)return s("internal.low-authority");for(let o of Object.values(i._options))if(o.name in n&&o.authority>r.user.authority)return s("internal.low-authority")},!0),e.before("command/execute",t=>{let{args:r,options:n,command:i,session:s}=t;function o(a,...c){return i.config.showWarning?s.text(a,c):""}if(q(o,"sendHint"),i.config.checkArgCount){if((i._arguments[r.length]||{}).required)return o("internal.insufficient-arguments");let c=i._arguments[i._arguments.length-1]||{};if(r.length>i._arguments.length&&c.type!=="text"&&!c.variadic)return o("internal.redunant-arguments")}if(i.config.checkUnknown){let a=Object.keys(n).filter(c=>!i._options[c]);if(a.length)return o("internal.unknown-option",a.join(", "))}},!0)}q(is,"validate");var nt=class{constructor(e,t={}){this.ctx=e,this.config=t,S(this,X.current,e),e.plugin(ns),e.plugin(is)}_commandList=[];_commands=new Map;_shortcuts=[];get caller(){return this[X.current]}resolve(e){if(!e)return;let t=e.split("."),r=1,n=t[0],i;for(;(i=this.getCommand(n))&&r<t.length;)n=i.name+"."+t[r++];return i}getCommand(e){return this._commands.get(e)}command(e,...t){let r=typeof t[0]=="string"?t.shift():"",n=t[0],i=e.split(" ",1)[0].toLowerCase(),s=e.slice(i.length),o=i.split(/(?=[./])/g),a,c,p=[];if(o.forEach((u,l)=>{let f=u.charCodeAt(0),m=f===46?a.name+u:f===47?u.slice(1):u,y=this.getCommand(m);if(y){if(a){if(y===a)throw new Error(`cannot set a command (${y.name}) as its own subcommand`);if(y.parent){if(y.parent!==a)throw new Error(`cannot create subcommand ${i}: ${y.parent.name}/${y.name} already exists`)}else y.parent=a,a.children.push(y)}return a=y}y=new pe(m,s,this.caller),p.push(y),c||(c=y),a&&(y.parent=a,y.config.authority=a.config.authority,a.children.push(y)),a=y}),r&&this.caller.i18n.define("",`commands.${a.name}.description`,r),Object.assign(a.config,n),p.forEach(u=>this.caller.emit("command-added",u)),!n?.patch)return c&&this.caller.state.disposables.unshift(()=>c.dispose()),a;c&&c.dispose();let h=Object.create(a);return h._disposables=this.caller.state.disposables,h}};q(nt,"Commander");ve(nt,"key","$commander");ve(nt,"methods",["command"]);X.service(nt.key,nt);var Gi=new ie("session"),ss=class extends rt{argv;user;channel;guild;parsed;scope;_queuedTasks;_queuedTimeout;constructor(e,t){super(e,t),S(this,"scope",null),S(this,"user",null),S(this,"channel",null),S(this,"guild",null),S(this,"_queuedTasks",[]),S(this,"_queuedTimeout",null)}get username(){let e=this.user&&this.user.name?this.user.name:this.author?this.author.nickname||this.author.username:this.userId;return this.app.chain("appellation",e,this)}async send(e){if(!!e)return this.bot.sendMessage(this.channelId,e,this.guildId).catch(t=>(Gi.warn(t),[]))}cancelQueued(e=this.app.config.delay.cancel){clearTimeout(this._queuedTimeout),this._queuedTasks=[],this._queuedTimeout=setTimeout(()=>this._next(),e)}_next(){let e=this._queuedTasks.shift();if(!e){this._queuedTimeout=null;return}this.send(e.content).then(e.resolve,e.reject),this._queuedTimeout=setTimeout(()=>this._next(),e.delay)}async sendQueued(e,t){let r=oe.normalize(e).toString();if(!!r){if(F(t)){let{message:n,character:i}=this.app.config.delay;t=Math.max(n,i*r.length)}return new Promise((n,i)=>{this._queuedTasks.push({content:e,delay:t,resolve:n,reject:i}),this._queuedTimeout||this._next()})}}resolveValue(e){return typeof e=="function"?Reflect.apply(e,null,[this]):e}async getChannel(e=this.channelId,t=[]){let{app:r,platform:n,guildId:i}=this;if(!t.length)return{platform:n,id:e,guildId:i};let s=await r.database.getChannel(n,e,t);if(s)return s;let o=await this.resolveValue(r.config.autoAssign)?this.selfId:"";if(o)return r.database.createChannel(n,e,{assignee:o,guildId:i});{let a=r.model.tables.channel.create();return Object.assign(a,{platform:n,id:e,guildId:i,$detached:!0}),a}}async _observeChannelLike(e,t=[]){let r=new Set(t),{platform:n}=this,i=`${n}:${e}`,s=this.app.$internal._channelCache.get(this.id,i);if(s){for(let a in s)r.delete(a);if(!r.size)return s}let o=await this.getChannel(e,[...r]);return s=this.app.$internal._channelCache.get(this.id,i),s?s.$merge(o):(s=Qe(o,a=>this.app.database.setChannel(n,e,a),`channel ${i}`),this.app.$internal._channelCache.set(this.id,i,s)),s}async observeChannel(e=[]){let t=[this._observeChannelLike(this.channelId,e)];this.channelId!==this.guildId&&t.push(this._observeChannelLike(this.guildId,e));let[r,n=r]=await Promise.all(t);return this.guild=n,this.channel=r,r}async getUser(e=this.userId,t=[]){let{app:r,platform:n}=this;if(!t.length)return{[n]:e};let i=await r.database.getUser(n,e,t);if(i)return i;let s=await this.resolveValue(r.config.autoAuthorize);if(s)return r.database.createUser(n,e,{authority:s});{let o=r.model.tables.user.create();return Object.assign(o,{[n]:e,authority:s,$detached:!0}),o}}async observeUser(e=[]){let t=new Set(e),{userId:r,platform:n}=this,i=this.app.$internal._userCache.get(this.id,this.uid);if(i){for(let o in i)t.delete(o);if(!t.size)return this.user=i}if(this.author?.anonymous){let o=this.app.model.tables.user.create();o[n]=r,o.authority=await this.resolveValue(this.app.config.autoAuthorize);let a=Qe(o,()=>Promise.resolve());return this.user=a}let s=await this.getUser(r,[...t]);return i=this.app.$internal._userCache.get(this.id,this.uid),i?i.$merge(s):(i=Qe(s,o=>this.app.database.setUser(this.platform,r,o),`user ${this.uid}`),this.app.$internal._userCache.set(this.id,this.uid,i)),this.user=i}async withScope(e,t){let r=this.scope;try{return this.scope=e,await t()}finally{this.scope=r}}text(e,t={}){let r=[this.app.config.locale];r.unshift(this.user?.locale),this.subtype==="group"&&(r.unshift(this.guild?.locale),r.unshift(this.channel?.locale));let n=te(e).map(i=>i.startsWith(".")?this.scope?this.scope+i:(this.app.logger("i18n").warn(new Error("missing scope")),""):i);return this.app.i18n.text(r,n,t)}collect(e,t,r=new Set){let n=q(i=>{if(i.session=this,i.tokens)for(let{inters:s}of i.tokens)s.forEach(n);!this.resolve(i)||(this.app.emit(i.session,`command/before-attach-${e}`,i,r),jr(i,pe[`_${e}Fields`],r),jr(i,i.command[`_${e}Fields`],r))},"collect");return n(t),r}inferCommand(e){if(e.command)return e.command;if(e.name)return e.command=this.app.$commander.resolve(e.name);let{parsed:t,subtype:r}=this;if(e.root&&r!=="private"&&t.prefix===null&&!t.appel)return;let n=[];for(;e.tokens.length;){let{content:i}=e.tokens[0];n.push(i);let s=this.app.$commander.resolve(n.join("."));if(!s||(e.tokens.shift(),e.command=s,s._actions.length))break}return e.command}resolve(e){if(!!this.inferCommand(e)){if(e.tokens?.every(t=>!t.inters.length)){let{options:t,args:r,error:n}=e.command.parse(e);e.options={...e.options,...t},e.args=[...e.args||[],...r],e.error=n}return e.command}}async execute(e,t){if(typeof e=="string"&&(e=Be.parse(e)),e.session=this,e.tokens){for(let i of e.tokens){let{inters:s}=i,o=[];for(let a=0;a<s.length;++a)o.push(await this.execute(s[a],!0));for(let a=s.length-1;a>=0;--a){let{pos:c}=s[a];i.content=i.content.slice(0,c)+o[a]+i.content.slice(c)}i.inters=[]}if(!this.resolve(e))return""}else if(e.command||=this.app.$commander.getCommand(e.name),!e.command)return Gi.warn(new Error(`cannot find command ${e.name}`)),"";let{command:r}=e;if(!r.ctx.filter(this))return"";this.app.database&&(this.subtype==="group"&&await this.observeChannel(this.collect("channel",e)),await this.observeUser(this.collect("user",e)));let n=!0;return t===!0&&(n=!1,t=void 0),this.withScope(`commands.${r.name}.messages`,async()=>{let i=await r.execute(e,t);return n?(await this.send(i),""):typeof i=="string"?i:oe(null,i).toString()})}middleware(e){let t=Dr(this);return this.app.middleware(async(r,n)=>t&&Dr(r)!==t?n():e(r,n),!0)}prompt(e=this.app.config.delay.prompt){return new Promise(t=>{let r=this.middleware(i=>{clearTimeout(n),r(),t(i.content)}),n=setTimeout(()=>{r(),t("")},e)})}};q(ss,"Session");function Dr(e){return""+e.userId+e.channelId}q(Dr,"getSessionId");function jr(e,t,r){for(let n of t){if(typeof n=="function"){n(e,r);continue}for(let i of n)r.add(i)}return r}q(jr,"collectFields");var Fr=_t;Fr.prototype.session=q(function(t){return new ss(this,t)},"session");Fr.prototype.getGuildMemberMap=q(async function(t){let r=await this.getGuildMemberList(t);return Object.fromEntries(r.map(n=>[n.userId,n.nickname||n.username]))},"getGuildMemberMap");Fr.prototype.broadcast=q(async function(t,r,n=this.ctx.root.config.delay.broadcast){let i=[];for(let s=0;s<t.length;s++){s&&n&&await Wt(n);try{let[o,a]=te(t[s]);i.push(...await this.sendMessage(o,r,a))}catch(o){this.ctx.logger("bot").warn(o)}}return i},"broadcast");var Ha={general:{name:"",paren:"{0}",quote:"{0}",comma:"",and:"",or:"",day:"",hour:"",minute:"",second:""},internal:{"low-authority":"","insufficient-arguments":"","redunant-arguments":"","invalid-argument":" {0} {1}","unknown-option":" {0}","invalid-option":" {0} {1}","check-syntax":"","invalid-number":"","invalid-integer":"","invalid-posint":"","invalid-natural":"","invalid-date":"","invalid-user":"","invalid-channel":""}},Ja={general:{name:"English",paren:" ({0}) ",quote:'"{0}"',comma:", ",and:"and",or:"or",day:"day",hour:"hour",minute:"minute",second:"second"},internal:{"low-authority":"Low authority.","insufficient-arguments":"Insufficient arguments, type help to see usage.","redunant-arguments":"Redunant arguments, type help to see usage.","invalid-argument":"Invalid argument {0}, {1}","unknown-option":"Unknown option {0}, type help to see usage.","invalid-option":"Invalid option {0}, {1}","check-syntax":"Type help to see usage.","invalid-number":"Expect a number.","invalid-integer":"Expect an integer.","invalid-posint":"Expect a positive integer.","invalid-natural":"Expect a non-negative integer.","invalid-date":"Expect a valid date.","invalid-user":"Expect a valid user.","invalid-channel":"Expect a valid channel."}},Va={general:{name:"",paren:"{0}",quote:"{0}",comma:"",and:"",or:"",day:"",hour:"",minute:"",second:""},internal:{"low-authority":"","insufficient-arguments":"help","redunant-arguments":"help","invalid-argument":"{0}{1}","unknown-option":"{0}help","invalid-option":"{0}{1}","check-syntax":"help","invalid-number":"","invalid-integer":"","invalid-posint":"","invalid-natural":"","invalid-date":"","invalid-user":"","invalid-channel":""}},Ka={general:{name:"francais",paren:" ({0}) ",quote:'"{0}"',comma:", ",and:"et",or:"ou",day:"jour",hour:"heure",minute:"minute",second:"seconde"},internal:{"low-authority":"Droits insuffisants.","insufficient-arguments":`Arguments insuffisants, tapez "help" pour afficher l'aide`,"redunant-arguments":`Arguments redondants, tapez "help" pour afficher l'aide`,"invalid-argument":"Arguments {0} invalides, {1}","unknown-option":`Option {0} inconnue, tapez "help" pour afficher l'aide`,"invalid-option":"Option {0} invalide, {1}","check-syntax":`Tapez "help" pour afficher l'aide`,"invalid-number":"Entrez un nombre.","invalid-integer":"Entrez un entier.","invalid-posint":"Entrez un entier positif.","invalid-natural":"Entrez un entier non ngatif.","invalid-date":"Entrez une date valide.","invalid-user":"Entrez un nom d'utilisateur valide.","invalid-channel":"Entrez un nom de canal valide."}},Qa={general:{name:"",paren:"{0}",quote:"{0}",comma:"",and:"",or:"",day:"",hour:"",minute:"",second:""},internal:{"low-authority":"","insufficient-arguments":"help","redunant-arguments":"help","invalid-argument":" {0} {1}","unknown-option":" {0}help","invalid-option":" {0} {1}","check-syntax":"help","invalid-number":"","invalid-integer":"","invalid-posint":"","invalid-natural":"","invalid-date":"","invalid-user":"","invalid-channel":""}},Yi=new ie("i18n"),Zi=Symbol("template"),os=class{_data={};_formatters={};_presets={};constructor(e){this.define("",{"":""}),this.define("zh",Ha),this.define("en",Ja),this.define("ja",Va),this.define("fr",Ka),this.define("zh-tw",Qa),this.registerBuiltins()}set(e,t,r){if(t.includes("@")||typeof r=="string"){let n=this._data[e],[i,s]=t.slice(0,-1).split("@");s&&(r[Zi]=s),!F(n[i])&&!e.startsWith("$")&&Yi.warn("override",e,i),n[i]=r,this[X.current]?.on("dispose",()=>{delete n[i]})}else for(let n in r)this.set(e,t+n+".",r[n])}define(e,...t){this._data[e]||={},typeof t[0]=="string"?this.set(e,t[0]+".",t[1]):this.set(e,"",t[0])}formatter(e,t){this._formatters[e]=t}preset(e,t){this._presets[e]=t}render(e,t,r){if(e!==void 0){if(typeof e!="string"){let n=e[Zi],i=this._presets[n];if(!i)throw new Error(`Preset "${n}" not found`);return i(e,t,r)}return e.replace(/\{(.+?)\}/g,(n,i)=>{let[s,...o]=i.split("|"),a=s.trim().split("."),c=t;for(let p of a)if(c=c[p],F(c))return"";for(let p of o){let h=p.trim().match(/(\w+)(?:\((.+)\))?/),u=this._formatters[h[1]];if(!u)throw new Error(`Formatter "${h[1]}" not found`);let l=h[2]?h[2].split(",").map(f=>f.trim()):[];c=u(c,l,r)}return c.toString()})}}text(e,t,r){let n=new Set;for(let i of e)!i||n.add(i);for(let i in this._data)i.startsWith("$")||n.add(i);for(let i of t)for(let s of n)for(let o of["$"+s,s]){let a=this._data[o]?.[i];if(a!==void 0)return this.render(a,r,s)}return Yi.warn("missing",t[0]),t[0]}registerBuiltins(){let e=["day","hour","minute","second"];this.formatter("time",(t,r,n)=>{for(let i=0;i<3;i++){let s=H[e[i]],o=H[e[i+1]];if(t>=s-o/2){t+=o/2;let a=Math.floor(t/s)+" "+this.text([n],["general."+e[i]],{});return t%s>o&&(a+=` ${Math.floor(t%s/o)} `+this.text([n],["general."+e[i+1]],{})),a}}return Math.round(t/H.second)+" "+this.text([n],["general.second"],{})}),this.preset("plural",(t,r,n)=>{let i=r.length in t?r.length:t.length-1;return this.render(t[i],r,n)}),this.preset("random",(t,r,n)=>this.render(Ut.pick(t),r,n)),this.preset("list",(t,r,n)=>{let i=Object.entries(r).map(([s,o])=>this.render(t.item,{key:s,value:o},n));return i.unshift(this.render(t.header,r,n)),i.push(this.render(t.footer,r,n)),i.join(`
`).trim()})}};q(os,"I18n");X.service("i18n",os);export{U as $,tt as Adapter,X as App,Be as Argv,Fr as Bot,Tr as Channel,pe as Command,nt as Commander,X as Context,ft as Database,Ot as DatabaseService,No as Driver,U as Eval,Qt as Executable,Kt as Field,os as I18n,Lr as Internal,ie as Logger,En as Model,ge as Next,Qi as Quester,Ut as Random,An as RuntimeError,R as Schema,kn as Selection,Mr as SelectorService,Yu as Service,ss as Session,Ir as SharedCache,H as Time,Nr as User,Eo as assertProperty,ze as camelCase,zr as camelize,$t as capitalize,Se as clone,Ke as coerce,ws as contain,Ss as deduplicate,Ue as deepEqual,Wa as defineConfig,ul as defineDriver,So as defineEnumProperty,S as defineProperty,_s as difference,Oo as enumKeys,qe as escapeRegExp,L as executeEval,ut as executeQuery,qo as executeSort,Ro as executeUpdate,Dr as getSessionId,oe as h,Wr as hyphenate,vc as interpolate,xs as intersection,de as is,Xt as isComparable,Sn as isEvalExpr,_o as isInteger,F as isNullable,Pe as isPlainObject,de as isType,te as makeArray,vn as merge,Et as noop,Qe as observe,bs as omit,We as paramCase,Ee as pick,On as randomId,z as remove,$o as renameProperty,Ie as resolveConfig,$s as sanitize,oe as segment,Wt as sleep,Es as snakeCase,st as trimSlash,kt as uncapitalize,Os as union,ue as valueMap,gs as version};
