var N=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var _=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of H(t))!K.call(e,i)&&i!==n&&N(e,i,{get:()=>t[i],enumerable:!(s=O(t,i))||s.enumerable});return e},g=(e,t,n)=>(_(e,t,"default"),n&&_(n,t,"default"));var o={};g(o,B);import*as B from"https://registry.koishi.chat/modules/koishi/index.js";function w(e,t,n,s){var i,c=!1,l=0;function v(){i&&clearTimeout(i)}function h(){v(),c=!0}typeof t!="boolean"&&(s=n,n=t,t=void 0);function r(){for(var u=arguments.length,d=new Array(u),a=0;a<u;a++)d[a]=arguments[a];var I=this,m=Date.now()-l;if(c)return;function S(){l=Date.now(),n.apply(I,d)}function y(){i=void 0}s&&!i&&S(),v(),s===void 0&&m>e?S():t!==!0&&(i=setTimeout(s?y:S,s===void 0?e-m:e))}return r.cancel=h,r}function b(e,t,n){return n===void 0?w(e,t,!1):w(e,n,t!==!1)}var p={};g(p,F);import*as F from"https://registry.koishi.chat/modules/@koishijs/plugin-console/index.js";var j=Object.defineProperty,f=(e,t)=>j(e,"name",{value:t,configurable:!0});function A(e){return(0,o.capitalize)((0,o.camelize)(e))}f(A,"format");function D(e){return e?!e.name||e.name==="apply"?"Anonymous":A(e.name):"App"}f(D,"getName");function E(e){let{state:t}=e.parent;return t.runtime.isForkable?t.uid:t.runtime.uid}f(E,"getSourceId");var x=class extends p.DataService{constructor(e){super(e,"insight"),e.console.addEntry(["https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/index.js","https://registry.koishi.chat/modules/@koishijs/plugin-insight/dist/style.css"]),e.on("internal/fork",this.update),e.on("internal/runtime",this.update),e.on("internal/service",this.update)}stop(){this.update.cancel()}update=b(0,()=>{this.refresh()});async get(){let e=[],t=[];for(let n of this.ctx.registry.values()){let s=function(r){return n.using.every(u=>r.ctx[u])},i=function(r){let{uid:u,alias:d,disposables:a}=r,I=a.length,m={uid:u,name:v,weight:I};d&&(m.name+=` <${A(d)}>`),e.push(m)},c=function(r,u,d){t.push({type:r,source:u,target:d})},l=function(r){for(let u of n.using){let a=r.ctx[u][o.Context.source]?.state.uid;!a||c("dashed",r.uid,a)}};f(s,"isActive"),f(i,"addNode"),f(c,"addEdge"),f(l,"addDeps");let v=D(n.plugin),h=n.plugin?.reusable;if(!h){if(!s(n))continue;i(n),l(n)}for(let r of n.children)if(n.isForkable){if(!s(r))continue;i(r),c("solid",E(r),r.uid),h?l(r):c("solid",r.uid,n.uid)}else e[e.length-1].weight+=r.disposables.length,c("solid",E(r),n.uid)}return{nodes:e,edges:t}}};f(x,"Insight");(e=>{e.using=["console"],e.Config=o.Schema.object({})})(x||(x={}));var V=x;export{V as default};
